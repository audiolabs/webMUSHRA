function AudioFileLoader(a,b){this.audioContext=a,this.errorHandler=b,this.callbackSuccess=null,this.files=[]}function GenericAudioControl(a,b,c,d){this.audioContext=a,this.bufferSize=parseInt(b),this.stimuli=c,this.errorHandler=d,this.eventListeners=[],this.audioMaxPositions=[],this.audioCurrentPositions=[],this.audioStimulusIndex=null,this.audioCommand=null,this.audioCommandSwitchIndex=null}function MushraAudioControl(a,b,c,d,e,f,g,h){this.audioContext=a,this.bufferSize=parseInt(b),this.reference=c,this.conditions=d,this.errorHandler=e,this.createAnchor35=f,this.createAnchor70=g,this.lowAnchor=null,this.midAnchor=null,this.audioPlaying=!1,this.audioCurrentPosition=0,this.audioSampleRate=null,this.audioLoopStart=0,this.audioLoopEnd=null,this.audioMaxPosition=null,this.audioStimulus=null,this.audioLoopingActive=!0,this.audioFadingActive=0,this.audioFadingIn=null,this.audioFadingCurrentPosition=0,this.audioFadingMaxPosition=parseInt(.005*audioContext.sampleRate),this.audioMinimumLoopDuration=parseInt(.5*audioContext.sampleRate),this.audioVolume=1,this.audioIsReferencePlaying=null,this.audioCurrentPositionRequest=null,this.audioFadingActiveRequest=null,this.eventListeners=[],this.conditions[this.conditions.length]=this.reference,this.createAnchor35&&(this.conditions[this.conditions.length]=this.createLowerAnchor35(this.reference.getAudioBuffer())),this.createAnchor70&&(this.conditions[this.conditions.length]=this.createLowerAnchor70(this.reference.getAudioBuffer())),!1!==h&&shuffle(this.conditions);var i=Math.min.apply(null,this.conditions.map(function(a){return a.getAudioBuffer().length})),j=Math.min(i,this.reference.getAudioBuffer().length);this.audioLoopEnd=j,this.audioMaxPosition=j,this.audioSampleRate=this.reference.getAudioBuffer().sampleRate}function DataSender(a){this.target=a.remoteService}function ErrorHandler(){this.errors=[]}function PageManager(a,b,c){this.pages=[],this.pagesIndex=-1,this.parentElementId=b,this.varName=a,this.callbacksPageEventChanged=[],this.localizer=c}function PageTemplateRenderer(a,b,c){this.progressbarId=null,this.headerId=null,this.navigationId=0,this.showButtonPreviousPage=b,this.language=c,this.pageManager=a,this.lockNextButtonQueued=!1,this.callbacksEventRefreshed=[]}function BS1116AudioControlInputController(a,b){this.mushraAudioControl=a,this.looping=b}function FilePlayerController(a){this.filePlayer=a}function InputControl(a,b){this.mushraAudioControl=a,this.looping=b}function MushraAudioControlInputController(a,b){this.mushraAudioControl=a,this.looping=b}function BS1116Rating(){this.reference=null,this.nonReference=null,this.referenceScore=null,this.nonReferenceScore=null,this.comment=null,this.time=null}function LikertMultiStimulusRating(){this.stimulus=null,this.stimulusRating=null,this.time=null}function LikertResponse(){this.stimulus=null,this.response=null,this.comment=null,this.time=null}function LikertSingleStimulusRating(){this.stimulus=null,this.stimulusRating=null,this.time=null}function MUSHRARating(){this.stimulus=null,this.score=null,this.comment=null,this.time=null}function PairedComparisonChoice(){this.reference=null,this.nonReference=null,this.answer=null,this.comment=null,this.time=null}function Participant(){this.name=[],this.response=[]}function Session(){this.testId=null,this.participant=new Participant,this.trials=[]}function SpatialASWRating(){this.position_outerRight=null,this.position_innerRight=null,this.position_outerLeft=null,this.position_innerLeft=null,this.stimulus=null,this.name=null}function SpatialHWDRating(){this.position_outerRight=null,this.position_innerRight=null,this.position_outerLeft=null,this.position_innerLeft=null,this.stimulus=null,this.name=null,this.height=null,this.depth=null}function SpatialLEVRating(){this.position_center=null,this.position_height=null,this.position_width1=null,this.position_width2=null,this.stimulus=null,this.name=null}function SpatialLocalizationRating(){this.position=null,this.stimulus=null,this.name=null}function Stimulus(a,b){this.id=a,this.filepath=b,this.audioBuffer=null}function Trial(){this.id="",this.type=null,this.responses=[]}function FilePlayer(a,b,c,d,e,f,g){this.audioContext=a,this.bufferSize=b,this.stimuli=c,this.errorHandler=d,this.language=e,this.localizer=f,this.genericAudioControl=new GenericAudioControl(this.audioContext,this.bufferSize,this.stimuli,this.errorHandler),this.progressBars=[],this.hideProgressBar=g,this.genericAudioControl.addEventListener(function(a){"processUpdate"==a.name&&$("#FilePlayer_progressbar_"+a.index).progressbar("option","value",a.currentSample/(a.numSamples-1)*100)}.bind(this)),this.hooks=[]}function LikertScale(a,b,c,d){this.responseConfig=a,this.prefix=b,this.initDisabled=c,this.callback=d,this.group=null,this.elements=null}function Localizer(){this.nlsFragments=new Object}function MushraValidator(a){this.errorHandler=a}function shuffle(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}}function WaveformVisualizer(a,b,c,d,e,f){this.variableName=a,this.parent=b,this.stimulus=c,this.showWaveform=d,this.enableLooping=e,this.mushraAudioControl=f,this.table=$('<table id="waveTable"></table>'),this.slider=$('<div id="slider"></div'),this.parentWavesurfer=$('<div id="parentWavesurfer"></div'),this.parentSlider=$("<div></div>"),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.enableLooping?this.parent.append(this.table):this.parent.append(this.parentWavesurfer);var g=c.getAudioBuffer(),h=g.numberOfChannels;this.avgOriginalSamples=new Float32Array(g.length);for(var i=0;i<g.length;++i){for(var j=0,k=0;k<h;k++)j+=g.getChannelData(k)[i];var l=j*(1/h);this.avgOriginalSamples[i]=l}this.resampledSamples=this.avgOriginalSamples,this.currentPosition=0,this.leftRegionPosition=0,this.rightRegionPosition=this.resampledSamples.length,this.numberEventListener=this.mushraAudioControl.addEventListener(function(a){if("processUpdate"==a.name&&this.setCurrentPosition(a.currentSample),this.enableLooping){if("loopStartChanged"==a.name||"loopChanged"==a.name){var b=a.start;parseFloat(this.slider.get(0).noUiSlider.get()[0])!=a.start&&this.slider.get(0).noUiSlider.set([b,this.slider.get(0).noUiSlider.get()[1]]);var c=this.leftRegionPosition;this.setLeftRegionPosition(b),c!=this.leftRegionPosition&&this.refresh()}if("loopEndChanged"==a.name||"loopChanged"==a.name){var d=a.end;parseFloat(this.slider.get(0).noUiSlider.get()[1])!=a.end&&this.slider.get(0).noUiSlider.set([this.slider.get(0).noUiSlider.get()[0],d]);var e=this.rightRegionPosition;this.setRightRegionPosition(d),e!=this.rightRegionPosition&&this.refresh()}}}.bind(this))}function BS1116Page(a,b,c,d,e,f,g,h,i,j,k){this.reference=a,this.condition=b,this.pageManager=c,this.pageTemplateRenderer=d,this.audioContext=e,this.bufferSize=f,this.audioFileLoader=g,this.session=h,this.pageConfig=i,this.errorHandler=j,this.language=k,this.mushraAudioControl=null,this.div=null,this.waveformVisualizer=null,this.currentItem=null,this.audioFileLoader.addFile(this.reference.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.reference),this.audioFileLoader.addFile(this.condition.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.condition),this.ratingB=null,this.ratingC=null,this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function BS1116PageManager(){}function FinishPage(a,b,c,d,e){this.pageManager=a,this.session=b,this.dataSender=c,this.pageConfig=d,this.language=e,this.likert=null,this.interval=null,this.errorDiv=$("<div style='color:red; font-weight:bold;'></div>"),void 0===this.pageConfig.questionnaire&&(this.pageConfig.questionnaire=new Array)}function GenericPage(a,b){this.pageManager=a,this.title=b.name,this.content=b.content,this.language=b.language}function LikertMultiStimulusPage(a,b,c,d,e,f,g,h,i){this.pageManager=a,this.pageConfig=c,this.pageTemplateRenderer=b,this.audioContext=d,this.bufferSize=e,this.audioFileLoader=f,this.session=g,this.errorHandler=h,this.language=i,this.fpc=null,this.results=[],this.time=0,this.startTimeOnPage=null,this.ratingMap=new Array,this.stimuli=[];for(var j in c.stimuli)this.stimuli[this.stimuli.length]=new Stimulus(j,c.stimuli[j]);shuffle(this.stimuli);for(var k=0;k<this.stimuli.length;++k)this.audioFileLoader.addFile(this.stimuli[k].getFilepath(),function(a,b){b.setAudioBuffer(a)},this.stimuli[k]);this.filePlayer=null,this.likerts=[]}function LikertSingleStimulusPage(a,b,c,d,e,f,g,h,i,j){this.pageManager=a,this.pageTemplateRenderer=b,this.pageConfig=c,this.audioContext=d,this.bufferSize=e,this.audioFileLoader=f,this.stimulus=g,this.session=h,this.errorHandler=i,this.language=j,this.fpc=null,this.audioFileLoader.addFile(this.stimulus.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.stimulus),this.filePlayer=null,this.waveformVisualizer=null,this.likerts=[],this.ratingMap={},this.time=0,this.startTimeOnPage=null,this.results=[]}function LikertSingleStimulusPageManager(){}function MushraPage(a,b,c,d,e,f,g,h,i){this.isMushra=!0,this.pageManager=a,this.audioContext=b,this.bufferSize=c,this.audioFileLoader=d,this.session=e,this.pageConfig=f,this.mushraValidator=g,this.errorHandler=h,this.language=i,this.mushraAudioControl=null,this.div=null,this.waveformVisualizer=null,this.macic=null,this.currentItem=null,this.tdLoop2=null,this.conditions=[];for(var j in this.pageConfig.stimuli)this.conditions[this.conditions.length]=new Stimulus(j,this.pageConfig.stimuli[j]);this.reference=new Stimulus("reference",this.pageConfig.reference),this.audioFileLoader.addFile(this.reference.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.reference);for(var k=0;k<this.conditions.length;++k)this.audioFileLoader.addFile(this.conditions[k].getFilepath(),function(a,b){b.setAudioBuffer(a)},this.conditions[k]);this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function Page(){}function PairedComparisonPage(a,b,c,d,e,f,g,h,i,j,k){this.reference=a,this.condition=b,this.pageManager=c,this.pageTemplateRenderer=d,this.audioContext=e,this.bufferSize=f,this.audioFileLoader=g,this.session=h,this.pageConfig=i,this.errorHandler=j,this.language=k,this.mushraAudioControl=null,this.div=null,this.waveformVisualizer=null,this.macic=null,this.currentItem=null,this.audioFileLoader.addFile(this.reference.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.reference),this.audioFileLoader.addFile(this.condition.getFilepath(),function(a,b){b.setAudioBuffer(a)},this.condition),this.choice=null,this.ratings=[],this.loop={start:null,end:null},this.slider={start:null,end:null},this.time=0,this.startTimeOnPage=null}function PairedComparisonPageManager(){}function SpatialPage(a,b,c,d,e,f,g,h){this.session=c,this.pageManager=a,this.pageConfig=b,this.numberOfSpheres=this.pageConfig.numberofLocObj,this.time=(new Date).getTime(),this.audioContext=d,this.bufferSize=e,this.audioFileLoader=audioFileLoader,this.errorHandler=errorHandler,this.language=h,this.stimuli=[],this.div=null,this.renderDivs=[],this.scenes=[],this.cameras=[],this.responses={},this.activeResponse=null,this.time=0,this.framerate=this.pageConfig.framerate,this.filePlayer=null,this.fpc=null,this.mouseDown=!1;for(var i in b.stimuli)this.stimuli[this.stimuli.length]=new Stimulus(i,b.stimuli[i]);shuffle(this.stimuli);for(var j=0;j<this.stimuli.length;++j)this.audioFileLoader.addFile(this.stimuli[j].getFilepath(),function(a,b){b.setAudioBuffer(a)},this.stimuli[j])}function VolumePage(a,b,c,d,e,f,g){this.pageManager=a,this.audioContext=b,this.audioFileLoader=c,this.pageConfig=d,this.bufferSize=e,this.errorHandler=f,this.language=g,this.fpc=null,this.played=!1,this.stimulus=new Stimulus("stimulus",d.stimulus),this.audioFileLoader.addFile(this.pageConfig.stimulus,function(a,b){b.setAudioBuffer(a)},this.stimulus),this.filePlayer=null,this.audioContext.volume=this.volume=this.pageConfig.defaultVolume}function Camera(a,b){switch(this.type=a,this.camera=null,this.type){case CameraType.PERSPECTIVE:this.camera=new THREE.PerspectiveCamera(45,b.getAttribute("width")/b.getAttribute("height"),1,1e4);break;case CameraType.ORTHOGRAPHIC:this.camera=new THREE.OrthographicCamera(-b.getAttribute("width")/2,b.getAttribute("width")/2,b.getAttribute("height")/2,-b.getAttribute("height")/2,0,1e4);break;default:console.log("Unknown camera type.")}}function ASWObject(a){this.objConfig=a,this.group,this.height=a.height,this.depth=a.depth,null==a.depth&&(this.depth=20),null==a.height&&(this.height=0),this.x=0,this.y=0,this.z=0,this.geometryLine1=new THREE.Geometry,this.geometryLine2=new THREE.Geometry,this.controlPoints=[],this.controlPoints[0]=[],this.controlPoints[1]=[],this.controlPoints[2]=[],this.controlPoints[3]=[],0!=this.height&&(this.controlPoints[4]=[],this.controlPoints[5]=[]),this.controlPoints[0][0]=a.bezierOuterLeft[0],this.controlPoints[0][1]=a.bezierOuterLeft[1],this.controlPoints[0][2]=a.bezierOuterLeft[2],this.controlPoints[1][0]=a.bezierInnerLeft[0],this.controlPoints[1][1]=a.bezierInnerLeft[1],this.controlPoints[1][2]=a.bezierInnerLeft[2],this.controlPoints[2][0]=a.bezierInnerRight[0],this.controlPoints[2][1]=a.bezierInnerRight[1],this.controlPoints[2][2]=a.bezierInnerRight[2],this.controlPoints[3][0]=a.bezierOuterRight[0],this.controlPoints[3][1]=a.bezierOuterRight[1],this.controlPoints[3][2]=a.bezierOuterRight[2],this.derivative=[],this.midpointOnCurve=[],this.tmp=[],this.extrudeBend=null,this.activeObj=null,this.group=new THREE.Object3D,this.scene,this.line=[],this.points=[],this.material=[],this.geometrySphere=new THREE.SphereGeometry(8,34,30);for(var b=0;b<this.controlPoints.length;++b)this.material[b]=new THREE.MeshPhongMaterial({color:a.color,ambient:a.color,emmissive:a.color}),this.points[b]=new THREE.Mesh(this.geometrySphere,this.material[b]);this.update()}function LEVObject(a){this.objConfig=a,this.activeObj,this.materialLEV,this.mesh,this.point0=new THREE.Vector3(a.position[0],a.position[1],a.position[2]),this.point1=new THREE.Vector3(a.size[0]+a.position[0],a.position[1],0),this.point2=new THREE.Vector3(0,a.position[1],a.size[2]+a.position[2]),this.point3=new THREE.Vector3(a.position[0],a.size[1]+a.position[1],a.position[2]),this.xAxis=null,this.yAxis=null,this.zAxis=null,this.dragNdrop0=null,this.dragNdrop1=null,this.material1,this.dragNdrop2=null,this.material1,this.material0=new THREE.MeshPhongMaterial({color:a.color,opacitiy:.1,ambient:3342336}),this.material1=new THREE.MeshPhongMaterial({color:a.color,opacitiy:.1,ambient:3342336}),this.material2=new THREE.MeshPhongMaterial({color:a.color,opacitiy:.1,ambient:3342336}),this.material3=new THREE.MeshPhongMaterial({color:a.color,opacitiy:.1,ambient:3342336});var b=new THREE.SphereGeometry(8,34,30);this.dragNdrop0=new THREE.Mesh(b,this.material0),this.dragNdrop0.position.x=this.point0.x,this.dragNdrop0.position.y=this.point0.y,this.dragNdrop0.position.z=this.point0.z,this.dragNdrop1=new THREE.Mesh(b,this.material1),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.y=this.point1.y,this.dragNdrop1.position.z=this.point1.z,this.dragNdrop2=new THREE.Mesh(b,this.material2),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.y=this.point2.y,this.dragNdrop2.position.z=this.point2.z,this.dragNdrop3=new THREE.Mesh(b,this.material3),this.dragNdrop3.position.x=this.point3.x,this.dragNdrop3.position.y=this.point3.y,this.dragNdrop3.position.z=this.point3.z;var c=new THREE.Geometry;c.vertices.push(this.dragNdrop0.position),c.vertices.push(this.dragNdrop1.position),this.xAxis=new THREE.Line(c,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip);var d=new THREE.Geometry;d.vertices.push(this.dragNdrop0.position),d.vertices.push(this.dragNdrop2.position),this.yAxis=new THREE.Line(d,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip);var e=new THREE.Geometry;e.vertices.push(this.dragNdrop0.position),e.vertices.push(this.dragNdrop3.position),this.zAxis=new THREE.Line(e,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.materialLEV=new THREE.MeshPhongMaterial({color:a.color,opacity:.5,transparent:!0,ambient:3342336}),this.geometry=new THREE.SphereGeometry(1,50,50),this.mesh=new THREE.Mesh(this.geometry,this.materialLEV),this.setPosition0(this.point0.x,this.point0.y,this.point0.z),this.setPosition1(this.point1.x,this.point1.y,this.point1.z),this.setPosition2(this.point2.x,this.point2.y,this.point2.z),this.setPosition3(this.point3.x,this.point3.y,this.point3.z)}function LocalizationObject(a){this.objConfig=a,this.material=new THREE.MeshPhongMaterial({color:a.color,ambient:3342336,emmissive:2236962}),this.geometry=new THREE.SphereGeometry(a.size,34,30),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.position.x=a.position[0],this.mesh.position.y=a.position[1],this.mesh.position.z=a.position[2]}function SpatialObject(a){this.scene=a}function Scene(a,b,c,d){this.pageConfig=c,this.scene=new THREE.Scene,this.parser=new DOMParser,this.wmCamera=b,this.camera=b.getCamera(),this.viewConfig=d,this.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(a.getAttribute("width"),a.getAttribute("height")),a.appendChild(this.renderer.domElement),this.divHeight=a.getAttribute("height"),this.height=null,this.width=null,this.depth=null,this.materialWall=null,this.material=null,this.materialWallLeft=null,this.materialWallRight=null,this.materialFloor=null,this.materialCeiling=null,this.ambient=null,this.wallLeft=null,this.wallRight=null,this.wall=null,this.wallfront=null,this.floor=null,this.ceiling=null}AudioFileLoader.prototype.addFile=function(a,b,c){this.files[this.files.length]={url:a,callback:b,callbackArgument:c}},AudioFileLoader.prototype.startLoading=function(a){this.callbackSuccess=a,0===this.files.length&&a();for(var b=0;b<this.files.length;++b){var c=new XMLHttpRequest;c.open("GET",this.files[b].url,!0),c.responseType="arraybuffer",c.onerror=function(b){this.errorHandler.sendError("Loading audio file failed: "+b),a()}.bind(this);var d={index:b,loader:this,request:c};c.onload=function(){this.loader.audioContext.decodeAudioData(this.request.response,function(b){this.loader.files[this.index].callback(b,this.loader.files[this.index].callbackArgument),this.loader.files[this.index]=null;for(var c=0;c<this.loader.files.length;++c)if(null!=this.loader.files[c])return;a()}.bind(this),function(a){this.errorHandler.sendError("Loading audio file failed: "+a)}.bind(this))}.bind(d),c.send()}},GenericAudioControl.prototype.removeEventListener=function(a){this.eventListeners[a]=null},GenericAudioControl.prototype.addEventListener=function(a){return this.eventListeners[this.eventListeners.length]=a,this.eventListeners.length-1},GenericAudioControl.prototype.sendEvent=function(a){for(var b=0;b<this.eventListeners.length;++b)null!==this.eventListeners[b]&&this.eventListeners[b](a)},GenericAudioControl.prototype.play=function(a){null===this.audioStimulusIndex?(this.audioStimulusIndex=a,this.audioCommand="play"):this.audioStimulusIndex!==a&&(this.audioCommand="switch",this.audioCommandSwitchIndex=a)},GenericAudioControl.prototype.stop=function(){null!==this.audioStimulusIndex&&(this.audioCommand="stop",this.audioStimulusIndex=null)},GenericAudioControl.prototype.pause=function(){null!==this.audioStimulusIndex&&(this.audioCommand="pause")},GenericAudioControl.prototype.getPosition=function(a){return this.audioCurrentPositions[a]},GenericAudioControl.prototype.getDuration=function(a){return this.audioMaxPositions[a]},GenericAudioControl.prototype.initAudio=function(){this.audioMaxPositions=[],this.audioCurrentPositions=[];var a;for(a=0;a<this.stimuli.length;++a)this.audioCurrentPositions[a]=0,this.audioMaxPositions[a]=this.stimuli[a].getAudioBuffer().length;this.dummyBufferSource=this.audioContext.createBufferSource(),this.dummyBufferSource.loop=!0,this.dummyBufferSource.buffer=this.audioContext.createBuffer(1,this.bufferSize,this.audioContext.sampleRate);var b=0;for(a=0;a<this.stimuli.length;++a)channels=this.stimuli[a].getAudioBuffer().numberOfChannels,channels>b&&(b=channels);var c=b>2?this.audioContext.destination.channelCount:b;this.scriptNode=this.audioContext.createScriptProcessor(this.bufferSize,1,c),this.scriptNode.onaudioprocess=function(a){this.process(a)}.bind(this),this.dummyBufferSource.connect(this.scriptNode),this.scriptNode.connect(this.audioContext.destination),this.dummyBufferSource.start()},GenericAudioControl.prototype.freeAudio=function(){this.stop(),this.dummyBufferSource.disconnect(),this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=null,this.dummyBufferSource=null,this.scriptNode=null},GenericAudioControl.prototype.process=function(a){var b,c,d,e,f,g=a.outputBuffer,h=(a.inputBuffer,this.audioStimulusIndex),i=this.audioCommandSwitchIndex;if(null!==h){var j=this.stimuli[h],k=j.getAudioBuffer(),l=null;if("switch"===this.audioCommand){f=null;var m=this.stimuli[i],n=m.getAudioBuffer();for(c=0;c<j.getAudioBuffer().numberOfChannels;++c){d=g.getChannelData(c),e=k.getChannelData(c);var o=n.getChannelData(c);for(l=this.audioCurrentPositions[h],f=this.audioCurrentPositions[i],b=0;b<g.length;++b)d[b]=e[l++]*(1-b/g.length)+o[f++]*(b/g.length),l>=this.audioMaxPositions[h]&&(l=0,p={name:"ended",index:h},this.sendEvent(p),this.stop()),f>=this.audioMaxPositions[i]&&(f=0,p={name:"ended",index:i},this.sendEvent(p),this.stop())}}else for(c=0;c<j.getAudioBuffer().numberOfChannels;++c)for(d=g.getChannelData(c),e=k.getChannelData(c),l=this.audioCurrentPositions[h],b=0;b<g.length;++b)d[b]=e[l++],l>=this.audioMaxPositions[h]&&(l=0,p={name:"ended",index:h},this.sendEvent(p),this.stop());if(this.audioCurrentPositions[h]=l,"pause"===this.audioCommand||"stop"===this.audioCommand){for(c=0;c<g.numberOfChannels;++c)for(d=g.getChannelData(c),b=0;b<g.length;++b)d[b]=d[b]*(1-b/g.length);this.audioStimulusIndex=null,"stop"===this.audioCommand&&(this.audioCurrentPositions[h]=0)}if("play"===this.audioCommand)for(c=0;c<g.numberOfChannels;++c)for(d=g.getChannelData(c),b=0;b<g.length;++b)d[b]=d[b]*(b/g.length);for(c=0;c<g.numberOfChannels;++c)for(d=g.getChannelData(c),b=0;b<g.length;++b)d[b]=d[b]*this.audioContext.volume;var p={name:"processUpdate",currentSample:l,numSamples:this.audioMaxPositions[h],index:h};this.sendEvent(p),"switch"===this.audioCommand&&(this.audioCurrentPositions[i]=f,this.audioStimulusIndex=i,p={name:"processUpdate",currentSample:f,numSamples:this.audioMaxPositions[i],index:i},this.sendEvent(p)),this.audioCommand=null}else for(c=0;c<g.numberOfChannels;++c)for(d=g.getChannelData(c),b=0;b<g.length;++b)d[b]=0},GenericAudioControl.prototype.setPosition=function(a,b){var c=this.audioStimulusIndex;null==c&&(c=0),this.audioCurrentPositions[c]=a;var d={name:"processUpdate",currentSample:this.audioCurrentPositions[c],numSamples:this.audioMaxPositions[c],index:c};this.sendEvent(d)},MushraAudioControl.prototype.createLowerAnchor35=function(a){var b=new Stimulus("anchor35",null),c={16000:[.00146057475,-.000353625658,-.00211669048,1.33181901e-17,.00283327134,.00063539025,-.00354377515,-.00160293357,.00415933602,.00293859058,-.00456995224,-.00465872931,.00464644276,.00675606346,-.00424229906,-.00919716509,.00319389291,.0119219071,-.00131632725,-.0148450328,-.00161017158,.017859864,.00587395476,-.0208439639,-.0119108739,.0236663818,.0204970606,-.0261959511,-.0332797851,.028309993,.0545868177,-.029902726,-.100469275,.0308926832,.316213188,.468427729,.316213188,.0308926832,-.100469275,-.029902726,.0545868177,.028309993,-.0332797851,-.0261959511,.0204970606,.0236663818,-.0119108739,-.0208439639,.00587395476,.017859864,-.00161017158,-.0148450328,-.00131632725,.0119219071,.00319389291,-.00919716509,-.00424229906,.00675606346,.00464644276,-.00465872931,-.00456995224,.00293859058,.00415933602,-.00160293357,-.00354377515,.00063539025,.00283327134,1.33181901e-17,-.00211669048,-.000353625658,.00146057475],22050:[.000952605741,-540270522e-13,-.00127762947,-.00131042292,.000190025918,.00182536152,.00170992319,-.000409988577,-.00250271626,-.00214566819,.000737474512,.00332812369,.00261061454,-.00120067309,-.00432364806,-.00309626869,.00183427383,.00551743347,.0035929075,-.00268271981,-.00694789149,-.00408985769,.00380597669,.00867104429,.00457582413,-.00529011523,-.0107739692,-.00503925474,.00726774322,.013401003,.00546872754,-.00996041093,-.0168093503,-.00585334427,.0137758737,.0215014677,.00618311408,-.0195648167,-.0285953063,-.00644931146,.0294554368,.0411458005,.00664479278,-.0506925442,-.0714114073,-.00676425808,.134027797,.278911088,.340222334,.278911088,.134027797,-.00676425808,-.0714114073,-.0506925442,.00664479278,.0411458005,.0294554368,-.00644931146,-.0285953063,-.0195648167,.00618311408,.0215014677,.0137758737,-.00585334427,-.0168093503,-.00996041093,.00546872754,.013401003,.00726774322,-.00503925474,-.0107739692,-.00529011523,.00457582413,.00867104429,.00380597669,-.00408985769,-.00694789149,-.00268271981,.0035929075,.00551743347,.00183427383,-.00309626869,-.00432364806,-.00120067309,.00261061454,.00332812369,.000737474512,-.00214566819,-.00250271626,-.000409988577,.00170992319,.00182536152,.000190025918,-.00131042292,-.00127762947,-540270522e-13,.000952605741],32000:[.000606868162,.000143747395,-.000489683231,-.000957379936,-.000960325242,-.000417728904,.000449945168,.00120031549,.00138937936,.000825904537,-.00028215794,-.00138886266,-.0018728162,-.0013784479,-521614709e-13,.00147437405,.00237664707,.00207495799,.000588782307,-.00140129392,-.00285363105,-.00290225508,-.00135803188,.00110897785,.0032433065,.00383275857,.00238254276,-.000533301611,-.00347219682,-.00482346902,-.00367593495,-.000392692298,.0034535061,.00581536918,.00524301539,.00174034066,-.00308500074,-.00673269714,-.00708234698,-.00359130075,.00224251785,.00748083884,.00919271334,.00605234225,-.000763633833,-.00793999457,-.0115868202,-.00928931164,-.00159164371,.00794756191,.0143209098,.0136079502,.00523968294,-.00724896864,-.0175669342,-.0196698839,-.0110538132,.00534562546,.0218284858,.0292009619,.0213598555,-.000901475403,-.0288345136,-.0483076339,-.0452805665,-.0120351498,.0485303746,.122599703,.189585306,.229288491,.229288491,.189585306,.122599703,.0485303746,-.0120351498,-.0452805665,-.0483076339,-.0288345136,-.000901475403,.0213598555,.0292009619,.0218284858,.00534562546,-.0110538132,-.0196698839,-.0175669342,-.00724896864,.00523968294,.0136079502,.0143209098,.00794756191,-.00159164371,-.00928931164,-.0115868202,-.00793999457,-.000763633833,.00605234225,.00919271334,.00748083884,.00224251785,-.00359130075,-.00708234698,-.00673269714,-.00308500074,.00174034066,.00524301539,.00581536918,.0034535061,-.000392692298,-.00367593495,-.00482346902,-.00347219682,-.000533301611,.00238254276,.00383275857,.0032433065,.00110897785,-.00135803188,-.00290225508,-.00285363105,-.00140129392,.000588782307,.00207495799,.00237664707,.00147437405,-521614709e-13,-.0013784479,-.0018728162,-.00138886266,-.00028215794,.000825904537,.00138937936,.00120031549,.000449945168,-.000417728904,-.000960325242,-.000957379936,-.000489683231,.000143747395,.000606868162],44100:[.000385585487,.000133034743,-.000194118449,-.000505722104,-.000704834248,-.000716894007,-.000515420887,-.000135834153,.000328234037,.000746924123,.000989641735,.000964595401,.000650699563,.000111322602,-.000516136594,-.00105407906,-.00133398588,-.00124774623,-.000785754644,-490812421e-13,.000770326741,.00143838339,.00174455797,.00156640738,.000913606436,-634018697e-13,-.0011057284,-.00191319916,-.00222936025,-.00192063974,-.00102578505,.000241433178,.00154080481,.00249532689,.00279877877,.00231100982,.00111200144,-.000504343499,-.0020994943,-.00320719753,-.00346741253,-.00273942131,-.00115952039,.000877685355,.00281463346,.00408072966,.00425727013,.00321052111,.00115194504,-.00139728242,-.00373423174,-.00516439618,-.00520361645,-.00373421028,-.00106679354,.00211705467,.00493360865,.00653696348,.00636639211,.00433049385,.000870420254,-.00312520748,-.00654071007,-.00833647519,-.00785458392,-.00503985239,-.000506491547,.00458108702,.00879468,.0108285771,.00988481876,.0059485687,-.000133497735,-.00681123281,-.0122025771,-.0145947015,-.0129478282,-.00726293801,.00130073897,.0106152311,.0180600648,.02118718,.0184183105,.00959660845,-.00376347351,-.0186204222,-.0309450406,-.0365583033,-.0320911389,-.015848259,.0116325554,.0474743894,.0868589947,.123865178,.15258148,.16825952,.16825952,.15258148,.123865178,.0868589947,.0474743894,.0116325554,-.015848259,-.0320911389,-.0365583033,-.0309450406,-.0186204222,-.00376347351,.00959660845,.0184183105,.02118718,.0180600648,.0106152311,.00130073897,-.00726293801,-.0129478282,-.0145947015,-.0122025771,-.00681123281,-.000133497735,.0059485687,.00988481876,.0108285771,.00879468,.00458108702,-.000506491547,-.00503985239,-.00785458392,-.00833647519,-.00654071007,-.00312520748,.000870420254,.00433049385,.00636639211,.00653696348,.00493360865,.00211705467,-.00106679354,-.00373421028,-.00520361645,-.00516439618,-.00373423174,-.00139728242,.00115194504,.00321052111,.00425727013,.00408072966,.00281463346,.000877685355,-.00115952039,-.00273942131,-.00346741253,-.00320719753,-.0020994943,-.000504343499,.00111200144,.00231100982,.00279877877,.00249532689,.00154080481,.000241433178,-.00102578505,-.00192063974,-.00222936025,-.00191319916,-.0011057284,-634018697e-13,.000913606436,.00156640738,.00174455797,.00143838339,.000770326741,-490812421e-13,-.000785754644,-.00124774623,-.00133398588,-.00105407906,-.000516136594,.000111322602,.000650699563,.000964595401,.000989641735,.000746924123,.000328234037,-.000135834153,-.000515420887,-.000716894007,-.000704834248,-.000505722104,-.000194118449,.000133034743,.000385585487],
48000:[.000265962912,269444584e-13,-.000248821161,-.000494662851,-.000643796534,-.000646775759,-.000486311783,-.00018528049,.000194893397,.000566035055,.000833148354,.00091809972,.000781287127,.000435505261,-522979429e-13,-.000572944907,-.000998822202,-.00121452462,-.00114713457,-.000788392101,-.000202420545,.000484181162,.00110885003,.00151084654,.00157170064,.00124833405,.000589933696,-.000266953314,-.00112557915,-.00177332628,-.00203342793,-.00181170379,-.00112625841,-.000111457054,.00100671953,.00195990923,.00250073799,.00246559981,.00182121733,.00068227443,-.000706303532,-.00202053023,-.00293168746,-.00318704737,-.00267749645,-.00147446748,.000175042337,.00189701892,.00327357683,.00394261376,.00369060569,.00251528679,.000640787624,-.00152170555,-.00346182551,-.00468821039,-.00485014653,-.00383316972,-.00180350513,.000812985611,.00341669253,.00536850308,.00614306024,.00546508185,.00339445006,.000335843306,-.00303472869,-.00591458059,-.00756029023,-.00747297626,-.0055381722,-.00208327545,.00216735243,.00623652135,.00911056463,.00998170297,.00846059896,.00470613719,-.000565026394,-.00620120019,-.0108526668,-.0132768685,-.0126461656,-.00878669367,-.00228687538,.00556114655,.0129890766,.0181131879,.0193598332,.0158676325,.00777636434,-.00366989653,-.0162436399,-.0270725072,-.0331434635,-.0318828143,-.0217012916,-.00239409277,.0246911341,.0567636975,.0899696543,.119982256,.142700869,.154932754,.154932754,.142700869,.119982256,.0899696543,.0567636975,.0246911341,-.00239409277,-.0217012916,-.0318828143,-.0331434635,-.0270725072,-.0162436399,-.00366989653,.00777636434,.0158676325,.0193598332,.0181131879,.0129890766,.00556114655,-.00228687538,-.00878669367,-.0126461656,-.0132768685,-.0108526668,-.00620120019,-.000565026394,.00470613719,.00846059896,.00998170297,.00911056463,.00623652135,.00216735243,-.00208327545,-.0055381722,-.00747297626,-.00756029023,-.00591458059,-.00303472869,.000335843306,.00339445006,.00546508185,.00614306024,.00536850308,.00341669253,.000812985611,-.00180350513,-.00383316972,-.00485014653,-.00468821039,-.00346182551,-.00152170555,.000640787624,.00251528679,.00369060569,.00394261376,.00327357683,.00189701892,.000175042337,-.00147446748,-.00267749645,-.00318704737,-.00293168746,-.00202053023,-.000706303532,.00068227443,.00182121733,.00246559981,.00250073799,.00195990923,.00100671953,-.000111457054,-.00112625841,-.00181170379,-.00203342793,-.00177332628,-.00112557915,-.000266953314,.000589933696,.00124833405,.00157170064,.00151084654,.00110885003,.000484181162,-.000202420545,-.000788392101,-.00114713457,-.00121452462,-.000998822202,-.000572944907,-522979429e-13,.000435505261,.000781287127,.00091809972,.000833148354,.000566035055,.000194893397,-.00018528049,-.000486311783,-.000646775759,-.000643796534,-.000494662851,-.000248821161,269444584e-13,.000265962912]},d=c[a.sampleRate.toString()];return null===d?(this.errorHandler.sendError("Sample size"+a.sampleRate+" is not supported for creating anchors."),null):(b.setAudioBuffer(this.convolve(a,d)),b)},MushraAudioControl.prototype.createLowerAnchor70=function(a){var b=new Stimulus("anchor70",null),c={16000:[-.00118209226,.00100896033,-.000618592779,-3.0648982e-21,.000828010143,-.00181288756,.0028680964,-.00387720074,.00470245853,-.00519757939,.00522375966,-.00466760994,.00345919995,-.00158821811,-.000883779279,.00381685249,-.00699329572,.0101261709,-.012875787,.0148733309,-.0157500548,.0151697236,-.0128615154,.00865031066,-.00248133933,-.00556350253,.0152597233,-.0262458867,.03804101,-.0500727925,.0617147172,-.0723291806,.0813131625,-.0881426193,.0924118081,.907353278,.0924118081,-.0881426193,.0813131625,-.0723291806,.0617147172,-.0500727925,.03804101,-.0262458867,.0152597233,-.00556350253,-.00248133933,.00865031066,-.0128615154,.0151697236,-.0157500548,.0148733309,-.012875787,.0101261709,-.00699329572,.00381685249,-.000883779279,-.00158821811,.00345919995,-.00466760994,.00522375966,-.00519757939,.00470245853,-.00387720074,.0028680964,-.00181288756,.000828010143,-3.0648982e-21,-.000618592779,.00100896033,-.00118209226],22050:[-.00109204743,.000364387668,.00100704951,-.00153304385,.000365790771,.00151198395,-.0020376718,.000291370261,.00216171702,-.00260011167,.000112849298,.0029784736,-.00321181316,-.000203222908,.00398744555,-.00386164534,-.000697103657,.00521902698,-.00453617643,-.00141884616,.00671283398,-.00522007536,-.00243379393,.00852493523,-.00589662042,-.00383289594,.0107412503,-.00654829386,-.00575289893,.0135037854,-.00715743651,-.00841856686,.0170663665,-.0077069323,-.0122398534,.0219272797,-.00818089034,-.0180687354,.0292000372,-.00856529187,-.0280344748,.0419362692,-.00884857023,-.0493861012,.0723989052,-.00902209522,-.132916342,.280240308,.658338972,.280240308,-.132916342,-.00902209522,.0723989052,-.0493861012,-.00884857023,.0419362692,-.0280344748,-.00856529187,.0292000372,-.0180687354,-.00818089034,.0219272797,-.0122398534,-.0077069323,.0170663665,-.00841856686,-.00715743651,.0135037854,-.00575289893,-.00654829386,.0107412503,-.00383289594,-.00589662042,.00852493523,-.00243379393,-.00522007536,.00671283398,-.00141884616,-.00453617643,.00521902698,-.000697103657,-.00386164534,.00398744555,-.000203222908,-.00321181316,.0029784736,.000112849298,-.00260011167,.00216171702,.000291370261,-.0020376718,.00151198395,.000365790771,-.00153304385,.00100704951,.000364387668,-.00109204743],32000:[-.000769448174,-.000102908895,.000882007876,.000402489768,-.000908180556,-.000758018375,.000816478586,.00113513958,-.000584105594,-.00148760313,.000201997134,.00176093904,.000321000527,-.00189789137,-.000955484664,.00184520796,.00165095747,-.00156116233,-.00233779021,.00102301221,.0029318393,-.000233502393,-.00334157226,-.000774482154,.0034772551,.00193590651,-.00326146644,-.00315481067,.00263997272,.00430907238,-.00159185405,-.00525866243,.000137737071,.00585697226,.00165491779,-.00596443449,-.00367031062,.00546335487,.00574708382,-.00427266973,-.00768547855,.00236126969,.0092584779,.000241387121,-.0102260537,-.00343839395,.0103511491,.00706282811,-.00941556234,-.0108794297,.0072334174,.014589529,-.00365926237,-.017836807,-.00141335654,.020208968,.00806981719,-.0212250788,-.0164233734,.0202846888,.0267322768,-.0165130681,-.0397002851,.00827992408,.0574112325,.00861597499,-.0874119634,-.0515418427,.179291016,.416071015,.416071015,.179291016,-.0515418427,-.0874119634,.00861597499,.0574112325,.00827992408,-.0397002851,-.0165130681,.0267322768,.0202846888,-.0164233734,-.0212250788,.00806981719,.020208968,-.00141335654,-.017836807,-.00365926237,.014589529,.0072334174,-.0108794297,-.00941556234,.00706282811,.0103511491,-.00343839395,-.0102260537,.000241387121,.0092584779,.00236126969,-.00768547855,-.00427266973,.00574708382,.00546335487,-.00367031062,-.00596443449,.00165491779,.00585697226,.000137737071,-.00525866243,-.00159185405,.00430907238,.00263997272,-.00315481067,-.00326146644,.00193590651,.0034772551,-.000774482154,-.00334157226,-.000233502393,.0029318393,.00102301221,-.00233779021,-.00156116233,.00165095747,.00184520796,-.000955484664,-.00189789137,.000321000527,.00176093904,.000201997134,-.00148760313,-.000584105594,.00113513958,.000816478586,-.000758018375,-.000908180556,.000402489768,.000882007876,-.000102908895,-.000769448174],44100:[-.000532571035,-.000132887083,.000459904635,.000651259705,.000189344568,-.000526843122,-.000783572104,-.000259251594,.000593819841,.000930096627,.000344234469,-.000659745775,-.00109139499,-.000446021415,.00072340291,.00126800749,.000566454777,-.000783437815,-.00146046149,-.000707508266,.00083835339,.00166928376,.000871310809,-.000886497904,-.0018950178,-.00106017909,.00092605019,.00213824725,.0012766615,-.000954999454,-.00239962702,-.00152359736,.000971117574,.00267992457,.00180419637,-.000971920987,-.00298007442,-.00212214573,.000954618037,.00330125036,.00248175508,-.000916035917,-.00364496198,-.0028881542,.000852518629,.00401318497,.00334756566,-.000759783224,-.00440853985,-.00386768584,.000632714888,.00483454113,.0044582262,-.000465070593,-.00529595233,-.00513169752,.000249042659,.00579930374,.00590457233,253982932e-13,-.00635366889,-.00679905528,-.000371519121,.00697186608,.00784586582,.000807445389,-.00767238735,-.00908877832,-.00135884995,.0084826305,.0105923658,.00206362319,-.00944459856,-.0124559362,-.00298045962,.0106255937,.0148403291,.00420580554,-.0121398987,-.0180239389,-.00591049403,.0141973598,.0225334267,.00842914035,-.0172279931,-.0294984949,-.0125189233,.0222704419,.0418581019,.020334996,-.0326317143,-.0703914922,-.0414222929,.0674969577,.212121469,.314412351,.314412351,.212121469,.0674969577,-.0414222929,-.0703914922,-.0326317143,.020334996,.0418581019,.0222704419,-.0125189233,-.0294984949,-.0172279931,.00842914035,.0225334267,.0141973598,-.00591049403,-.0180239389,-.0121398987,.00420580554,.0148403291,.0106255937,-.00298045962,-.0124559362,-.00944459856,.00206362319,.0105923658,.0084826305,-.00135884995,-.00908877832,-.00767238735,.000807445389,.00784586582,.00697186608,-.000371519121,-.00679905528,-.00635366889,253982932e-13,.00590457233,.00579930374,.000249042659,-.00513169752,-.00529595233,-.000465070593,.0044582262,.00483454113,.000632714888,-.00386768584,-.00440853985,-.000759783224,.00334756566,.00401318497,.000852518629,-.0028881542,-.00364496198,-.000916035917,.00248175508,.00330125036,.000954618037,-.00212214573,-.00298007442,-.000971920987,.00180419637,.00267992457,.000971117574,-.00152359736,-.00239962702,-.000954999454,.0012766615,.00213824725,.00092605019,-.00106017909,-.0018950178,-.000886497904,.000871310809,.00166928376,.00083835339,-.000707508266,-.00146046149,-.000783437815,.000566454777,.00126800749,.00072340291,-.000446021415,-.00109139499,-.000659745775,.000344234469,.000930096627,.000593819841,-.000259251594,-.000783572104,-.000526843122,.000189344568,.000651259705,.000459904635,-.000132887083,-.000532571035],48000:[-.000382564326,626346183e-13,.00050768613,.000555633678,.000116282009,-.000476780129,-.000714904767,-.000347718209,.000365758872,.000832102312,.00061416739,-.000165826429,-.0008775865,-.000888589942,-.000121570886,.000824131005,.00113600937,.000482705267,-.000651095587,-.00131644851,-.000890743918,.000348525498,.00138905036,.00130643989,793456875e-13,-.00131706068,-.00168049112,-.000611711544,.0010732018,.00195754148,.00121038371,-.000644859068,-.00208160065,-.00182088957,384493874e-13,.00200246734,.00237562998,.000717642614,-.00168257606,-.00279903645,-.00157208738,.00110357317,.00301443897,.00245196246,-.000271881056,-.00295213872,-.00326659165,-.000777458991,.00255799998,.00391378054,.00197926022,-.00180175714,-.00428809769,-.00323938485,.000684194667,.00429060879,.00443881131,.000757587079,-.00383927574,-.00544043235,-.00244745458,.0028791113,.00609813465,.00427046011,-.00139115414,-.00626741483,-.00607605131,-.000600584332,.00581652723,.00768391283,.00302483882,-.00463694558,-.00889158112,-.00576176238,.00265173991,.00948233399,.00864431517,.000179740322,-.00923091568,-.0114613327,-.00386290552,.00790296283,.013959864,.00837781643,-.00524027235,-.0158415386,-.013704186,.000914425627,.0167405873,.0198772964,.00559761815,-.0161492402,-.0271234522,-.0153659305,.0131726637,.0362618849,.0312154049,-.0055652663,-.0503789399,-.0637602398,-.0162502462,.0884466598,.209778037,.290764233,.290764233,.209778037,.0884466598,-.0162502462,-.0637602398,-.0503789399,-.0055652663,.0312154049,.0362618849,.0131726637,-.0153659305,-.0271234522,-.0161492402,.00559761815,.0198772964,.0167405873,.000914425627,-.013704186,-.0158415386,-.00524027235,.00837781643,.013959864,.00790296283,-.00386290552,-.0114613327,-.00923091568,.000179740322,.00864431517,.00948233399,.00265173991,-.00576176238,-.00889158112,-.00463694558,.00302483882,.00768391283,.00581652723,-.000600584332,-.00607605131,-.00626741483,-.00139115414,.00427046011,.00609813465,.0028791113,-.00244745458,-.00544043235,-.00383927574,.000757587079,.00443881131,.00429060879,.000684194667,-.00323938485,-.00428809769,-.00180175714,.00197926022,.00391378054,.00255799998,-.000777458991,-.00326659165,-.00295213872,-.000271881056,.00245196246,.00301443897,.00110357317,-.00157208738,-.00279903645,-.00168257606,.000717642614,.00237562998,.00200246734,384493874e-13,-.00182088957,-.00208160065,-.000644859068,.00121038371,.00195754148,.0010732018,-.000611711544,-.00168049112,-.00131706068,793456875e-13,.00130643989,.00138905036,.000348525498,-.000890743918,-.00131644851,-.000651095587,.000482705267,.00113600937,.000824131005,-.000121570886,-.000888589942,-.0008775865,-.000165826429,.00061416739,.000832102312,.000365758872,-.000347718209,-.000714904767,-.000476780129,.000116282009,.000555633678,.00050768613,626346183e-13,-.000382564326]},d=c[a.sampleRate.toString()];return null===d?(this.errorHandler.sendError("Sample size"+a.sampleRate+" is not supported for creating anchors."),null):(b.setAudioBuffer(this.convolve(a,d)),b)},MushraAudioControl.prototype.convolve=function(a,b){for(var c=this.audioContext.createBuffer(a.numberOfChannels,a.length,a.sampleRate),d=0;d<a.numberOfChannels;++d){for(var e=a.getChannelData(d),f=new Float32Array(a.length+b.length-1),g=0;g<a.length+b.length-1;++g){f[g]=0;for(var h=g>=b.length-1?g-(b.length-1):0,i=g<a.length-1?g:a.length-1,j=h;j<=i;++j)f[g]+=e[j]*b[g-j]}for(var k=c.getChannelData(d),l=b.length-1,m=0;m<c.length;++m)k[m]=f[l+m]}return c},MushraAudioControl.prototype.removeEventListener=function(a){this.eventListeners[a]=null},MushraAudioControl.prototype.addEventListener=function(a){return this.eventListeners[this.eventListeners.length]=a,this.eventListeners.length-1},MushraAudioControl.prototype.sendEvent=function(a){for(var b=0;b<this.eventListeners.length;++b)null!==this.eventListeners[b]&&this.eventListeners[b](a)},MushraAudioControl.prototype.getPosition=function(){return this.audioCurrentPosition},MushraAudioControl.prototype.getDuration=function(){return this.audioMaxPosition},MushraAudioControl.prototype.initAudio=function(){this.dummyBufferSource=this.audioContext.createBufferSource(),this.dummyBufferSource.loop=!0,this.dummyBufferSource.buffer=this.audioContext.createBuffer(1,this.bufferSize,this.audioContext.sampleRate);var a=this.reference.getAudioBuffer().numberOfChannels>2?this.audioContext.destination.channelCount:this.reference.getAudioBuffer().numberOfChannels;this.scriptNode=this.audioContext.createScriptProcessor(this.bufferSize,1,a),this.scriptNode.onaudioprocess=function(a){this.process(a)}.bind(this),this.dummyBufferSource.connect(this.scriptNode),this.scriptNode.connect(this.audioContext.destination),this.dummyBufferSource.start()},MushraAudioControl.prototype.freeAudio=function(){this.stop(),this.dummyBufferSource.disconnect(),this.scriptNode.disconnect(),this.scriptNode.onaudioprocess=null,this.dummyBufferSource=null,this.scriptNode=null},MushraAudioControl.prototype.setLoopingActive=function(a){this.audioLoopingActive=a},MushraAudioControl.prototype.isLoopingActive=function(){return this.audioLoopingActive},MushraAudioControl.prototype.process=function(a){var b,c,d,e,f=a.outputBuffer,g=(a.inputBuffer,this.audioStimulus);if(null!==g&&!1!==this.audioPlaying){var h=g.getAudioBuffer();this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPosition=this.audioLoopStart),null!==this.audioCurrentPositionRequest&&(this.audioCurrentPosition=this.audioCurrentPositionRequest,this.audioCurrentPositionRequest=null),null!==this.audioFadingActiveRequest&&(this.audioFadingActive=this.audioFadingActiveRequest,this.audioFadingActiveRequest=null);var i=null,j=null,k=null,l=this.audioLoopingActive;for(e=0;e<this.reference.getAudioBuffer().numberOfChannels;++e){d=f.getChannelData(e),inputData=h.getChannelData(e),i=this.audioCurrentPosition,j=this.audioFadingCurrentPosition,k=this.audioFadingActive;for(b=0;b<f.length;++b){if(l&&i==this.audioLoopEnd-this.audioFadingMaxPosition&&(k=1,this.audioFadingIn=this.audioStimulus,j=0),1==k){if(c=.5*(1+Math.cos(Math.PI*j++/(this.audioFadingMaxPosition-1))),d[b]=inputData[i++]*c,j>=this.audioFadingMaxPosition){if(k=2,j=0,null===this.audioFadingIn){for(this.audioPlaying=!1,j=0,k=0;b<f.length;++b)d[b]=0;break}g=this.audioStimulus=this.audioFadingIn,inputData=g.getAudioBuffer().getChannelData(e)}}else 2==k?(c=.5*(1-Math.cos(Math.PI*j++/(this.audioFadingMaxPosition-1))),d[b]=inputData[i++]*c,j>=this.audioFadingMaxPosition&&(j=0,k=0)):d[b]=inputData[i++];i>=this.audioLoopEnd&&(i=this.audioLoopStart,!1===l&&(this.audioPlaying=!1))}}for(e=0;e<f.numberOfChannels;++e)for(d=f.getChannelData(e),b=0;b<f.length;++b)d[b]=d[b]*this.audioContext.volume;this.audioCurrentPosition=i,this.audioFadingCurrentPosition=j,this.audioFadingActive=k;var m={name:"processUpdate",currentSample:this.audioCurrentPosition,sampleRate:this.audioSampleRate};this.sendEvent(m)}else for(e=0;e<f.numberOfChannels;++e)for(d=f.getChannelData(e),b=0;b<f.length;++b)d[b]=0},MushraAudioControl.prototype.setLoopStart=function(a){if(a>=0&&a<this.audioLoopEnd&&this.audioLoopEnd-a>=this.audioMinimumLoopDuration){this.audioLoopStart=a,this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPositionRequest=this.audioLoopStart);var b={name:"loopStartChanged",start:this.audioLoopStart,end:this.audioLoopEnd};this.sendEvent(b)}},MushraAudioControl.prototype.setLoopEnd=function(a){if(a<=this.audioMaxPosition&&a>this.audioLoopStart&&a-this.audioLoopStart>=this.audioMinimumLoopDuration){this.audioLoopEnd=a,this.audioCurrentPosition>this.audioLoopEnd&&(this.audioCurrentPositionRequest=this.audioLoopEnd);var b={name:"loopEndChanged",start:this.audioLoopStart,end:this.audioLoopEnd};this.sendEvent(b)}},MushraAudioControl.prototype.setLoop=function(a,b){var c=!1;if(a>=0&&a<this.audioLoopEnd&&b-a>=this.audioMinimumLoopDuration&&a!=this.audioLoopStart&&(this.audioLoopStart=a,this.audioCurrentPosition<this.audioLoopStart&&(this.audioCurrentPositionRequest=this.audioLoopStart),c=!0),b<=this.audioMaxPosition&&b>this.audioLoopStart&&b-a>=this.audioMinimumLoopDuration&&b!=this.audioLoopEnd&&(this.audioLoopEnd=b,this.audioCurrentPosition>this.audioLoopEnd&&(this.audioCurrentPositionRequest=this.audioLoopEnd),c=!0),1==c){var d={name:"loopChanged",start:this.audioLoopStart,end:this.audioLoopEnd};this.sendEvent(d)}},MushraAudioControl.prototype.setPosition=function(a,b){this.audioCurrentPositionRequest=a,b&&(a<this.audioLoopStart||a<=parseInt((this.audioLoopEnd+this.audioLoopStart)/2)?this.setLoopStart(a):(a>this.audioLoopEnd||a>parseInt((this.audioLoopEnd+this.audioLoopStart)/2))&&this.setLoopEnd(a));var c={name:"processUpdate",currentSample:this.audioCurrentPositionRequest,sampleRate:this.audioSampleRate};this.sendEvent(c)},MushraAudioControl.prototype.getNumSamples=function(){return this.audioMaxPosition},MushraAudioControl.prototype.play=function(a,b){null===a&&(a=this.audioStimulus),this.audioStimulus===a&&b===this.audioIsReferencePlaying||null===this.audioStimulus||!1===this.audioPlaying?(this.audioStimulus=a,!1===this.audioPlaying&&this.fadeIn(a)):this.fadeOut(a),this.audioPlaying=!0},MushraAudioControl.prototype.getActiveStimulus=function(){return this.audioStimulus},MushraAudioControl.prototype.playReference=function(){this.play(this.reference,!0),this.audioIsReferencePlaying=!0;var a={name:"playReferenceTriggered",conditionLength:this.conditions.length};this.sendEvent(a)},MushraAudioControl.prototype.playCondition=function(a){this.play(this.conditions[a],!1),this.audioIsReferencePlaying=!1;var b={name:"playConditionTriggered",index:a,length:this.conditions.length};this.sendEvent(b)},MushraAudioControl.prototype.fadeOut=function(a){this.audioFadingIn=a,this.audioFadingCurrentPositionRequest=0,this.audioFadingActiveRequest=1},MushraAudioControl.prototype.fadeIn=function(a){this.audioFadingIn=a,this.audioFadingCurrentPositionRequest=0,this.audioFadingActiveRequest=2},MushraAudioControl.prototype.pause=function(){!0===this.audioPlaying&&this.fadeOut(null);var a={name:"pauseTriggered",conditionLength:this.conditions.length};this.sendEvent(a)},MushraAudioControl.prototype.stop=function(){this.audioCurrentPositionRequest=this.audioLoopStart,!0===this.audioPlaying&&this.fadeOut(null);var a={name:"stopTriggered",conditionLength:this.conditions.length};this.sendEvent(a);var b={name:"processUpdate",currentSample:this.audioCurrentPositionRequest,sampleRate:this.audioSampleRate};this.sendEvent(b)},MushraAudioControl.prototype.getConditions=function(){return this.conditions},MushraAudioControl.prototype.getReferenceIndexOfConditions=function(){for(var a=0;a<this.conditions.length;++a)return this.conditions[a]===this.reference?a:null},DataSender.prototype.send=function(a){var b=JSON.stringify(a),c=new XMLHttpRequest,d="sessionJSON="+b;try{c.open("POST",config.remoteService,!1),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(d)}catch(a){return console.log(c.responseText),!0}return(""!=c.responseText||200!=c.status)&&(console.log(c.responseText),!0)},ErrorHandler.prototype.sendError=function(a){this.errors[this.errors.length]=a,console.log("ERROR: "+a)},ErrorHandler.prototype.errorOccurred=function(){return this.errors.length>0},ErrorHandler.prototype.getErrors=function(){return this.errors},PageManager.prototype.addCallbackPageEventChanged=function(a){this.callbacksPageEventChanged[this.callbacksPageEventChanged.length]=a},PageManager.prototype.addPage=function(a){this.pages[this.pages.length]=a},PageManager.prototype.getNextPage=function(){return this.pages[this.pagesIndex+1]},PageManager.prototype.getPageIndex=function(){return this.pagesIndex},PageManager.prototype.getNumPages=function(){return this.pages.length},PageManager.prototype.getPage=function(a){return this.pages[a]},PageManager.prototype.getCurrentPage=function(){return this.pages[this.pagesIndex]},PageManager.prototype.nextPage=function(){if(++this.pagesIndex<=this.pages.length){if(void 0!==this.pages[this.pagesIndex-1]&&void 0!==this.pages[this.pagesIndex-1].save&&this.pages[this.pagesIndex-1].save(),this.pagesIndex>=this.pages.length-1&&pageManager.getCurrentPage()instanceof FinishPage)for(var a=0;a<this.pages.length;++a)void 0!==this.pages[a].store&&this.pages[a].store();var b=this.parentElementId;$("#"+b).empty(),this.pages[this.pagesIndex].render($("#"+b)),this.pageEventChanged(),void 0!==this.getCurrentPage().load&&$("#"+b).append($("<script> "+this.getPageVariableName(this.getCurrentPage())+".load();<\/script>")),window.scrollTo(0,0)}else--this.pagesIndex},PageManager.prototype.previousPage=function(){if(--this.pagesIndex<=this.pages.length){null!==this.pages[this.pagesIndex+1]&&null!==this.pages[this.pagesIndex+1].save&&this.pages[this.pagesIndex+1].save();var a=this.parentElementId;$("#"+a).empty(),this.pages[this.pagesIndex].render($("#"+a)),this.pageEventChanged(),void 0!==this.getCurrentPage().load&&$("#"+a).append($("<script> "+this.getPageVariableName(this.getCurrentPage())+".load();<\/script>")),window.scrollTo(0,0)}else++this.pagesIndex},PageManager.prototype.start=function(){for(var a=0;a<this.pages.length;++a)void 0!==this.pages[a].init&&this.pages[a].init();this.nextPage()},PageManager.prototype.restart=function(){this.pagesIndex=-1,this.start()},PageManager.prototype.getPageVariableName=function(a){for(var b=0;b<this.pages.length;++b)if(this.pages[b]==a)return this.varName+".pages["+b+"]";return!1},PageManager.prototype.getPageManagerVariableName=function(){return this.varName},PageManager.prototype.pageEventChanged=function(){for(var a=0;a<this.callbacksPageEventChanged.length;++a)this.callbacksPageEventChanged[a]()},PageManager.prototype.getLocalizer=function(){return this.localizer},PageTemplateRenderer.prototype.addCallbackEventRefreshed=function(a){this.callbacksEventRefreshed[this.callbacksEventRefreshed.length]=a},PageTemplateRenderer.prototype.eventRefreshed=function(){for(var a=0;a<this.callbacksEventRefreshed.length;++a)this.callbacksEventRefreshed[a]()},PageTemplateRenderer.prototype.renderProgressBar=function(a){this.progressbarId=a,TolitoProgressBar(this.progressbarId).setOuterTheme("a").setInnerTheme("b").isMini(!0).setMax(100).setStartFrom(0).setInterval(0).showCounter(!1).build()},PageTemplateRenderer.prototype.renderHeader=function(a){this.headerId=a,$("#"+this.headerId).append(this.pageManager.getCurrentPage().getName())},PageTemplateRenderer.prototype.renderNavigation=function(a){this.navigationId=a;var b=!1;if(this.pageManager.getPageIndex()>0&&this.showButtonPreviousPage&&this.pageManager.getPageIndex()<this.pageManager.getNumPages()-1){var c=$("<button data-role='button' data-inline='true' onclick='"+this.pageManager.getPageManagerVariableName()+".previousPage();'>"+this.pageManager.getLocalizer().getFragment(this.language,"previousButton")+"</button>");$("#"+this.navigationId).append(c),b=!0}if(this.pageManager.getPageIndex()<this.pageManager.getNumPages()-1){var d=$("<button id='__button_next' data-role='button' data-inline='true' onclick='"+this.pageManager.getPageManagerVariableName()+".nextPage();'>"+this.pageManager.getLocalizer().getFragment(this.language,"nextButton")+"</button>");this.lockNextButtonQueued&&d.attr("disabled","disabled"),$("#"+this.navigationId).append(d),b=!0}b||$("#"+this.navigationId).remove(),this.lockNextButtonQueued=!1},PageTemplateRenderer.prototype.lockNextButton=function(){$("#__button_next").length>0?$("#__button_next").attr("disabled","disabled"):this.lockNextButtonQueued=!0},PageTemplateRenderer.prototype.unlockNextButton=function(){$("#__button_next").removeAttr("disabled")},PageTemplateRenderer.prototype.refresh=function(){$("#"+this.progressbarId).progressbar("option","value",this.pageManager.getPageIndex()/(this.pageManager.getNumPages()-1)*100),$("#"+this.headerId).empty(),this.renderHeader(this.headerId),$("#"+this.navigationId).empty(),this.renderNavigation(this.navigationId),$.mobile.activePage&&$.mobile.activePage.trigger("create"),setTimeout(function(){this.eventRefreshed()}.bind(this),1)},PageTemplateRenderer.prototype.clear=function(){null!=this.headerId&&$("#"+this.headerId).empty(),null!=this.navigationId&&$("#"+this.navigationId).empty()},BS1116AudioControlInputController.prototype.bind=function(){var a=this.mushraAudioControl.getConditions();Mousetrap.bind(["r","0"],function(){$("#buttonReference").click()}),Mousetrap.bind(["backspace"],function(){$("#buttonStop").click()}),Mousetrap.bind(["space"],function(){for(var b=!1,c=0;c<a.length;c++){if("true"==$("#buttonConditions"+c).attr("active")){1!=this.mushraAudioControl.audioPlaying&&this.mushraAudioControl.setPosition(this.mushraAudioControl.audioLoopStart),$("#buttonConditions"+c).click(),b=!1;break}if("true"==$("#buttonReference").attr("active")){1!=this.mushraAudioControl.audioPlaying&&this.mushraAudioControl.setPosition(this.mushraAudioControl.audioLoopStart),$("#buttonReference").click(),b=!1;break}b=!0}1==b&&$("#buttonReference").click()}.bind(this));var b=this.mushraAudioControl.getDuration();for(this.looping&&(Mousetrap.bind(["a"],function(){this.pageManager.getCurrentPage().setLoopStart()}),Mousetrap.bind(["b"],function(){this.pageManager.getCurrentPage().setLoopEnd()}),Mousetrap.bind(["B"],function(){this.mushraAudioControl.setLoopEnd(b)}.bind(this)),Mousetrap.bind(["A"],function(){this.mushraAudioControl.setLoopStart(0)}.bind(this))),i=0;i<a.length;++i)!function(b){Mousetrap.bind(String(b+1),function(){$("#buttonConditions"+b).click()}),Mousetrap.bind(["l"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions0").click();else if("true"==$("#buttonConditions"+(a.length-1)).attr("active"))$("#buttonReference").click();else for(var b=0;b<a.length-1;++b)if("true"==$("#buttonConditions"+b).attr("active")){var c=b+1;$("#buttonConditions"+c).click();break}}),Mousetrap.bind(["h"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions"+(a.length-1)).click();else if("true"==$("#buttonConditions0").attr("active"))$("#buttonReference").click();else for(var b=1;b<a.length;++b)if("true"==$("#buttonConditions"+b).attr("active")){var c=b-1;$("#buttonConditions"+c).click();break}}),Mousetrap.bind(["up","j","shift+up","shift+j"],function(b,c){for(addVal=0,-1!=c.indexOf("shift")?addVal=1:addVal=.01,j=0;j<a.length;++j){var d=$(".scales").get(j);if("true"==$(d).attr("active")){var e=parseFloat($(d).val())+addVal;$(d).val(e.toString()),$(d).slider().slider("refresh");break}}return!1}),Mousetrap.bind(["down","k","shift+down","shift+k"],function(b,c){for(addVal=0,-1!=c.indexOf("shift")?addVal=1:addVal=.01,j=0;j<a.length;++j){var d=$(".scales").get(j);if("true"==$(d).attr("active")){var e=parseFloat($(d).val())-addVal;$(d).val(e.toString()),$(d).slider().slider("refresh");break}}return!1})}(i);document.onkeydown=function(a){a||(a=window.event);var b=a.keyCode;return 8==b&&"TEXTAREA"!=(a.target||a.srcElement).tagName&&"INPUT"!=(a.target||a.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?a.stopPropagation():(alert("prevented"),a.returnValue=!1),!1):32==b&&"TEXTAREA"!=(a.target||a.srcElement).tagName&&"INPUT"!=(a.target||a.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?a.stopPropagation():(alert("prevented"),a.returnValue=!1),!1):void 0}},BS1116AudioControlInputController.prototype.unbind=function(){Mousetrap.unbind(["r","0","a","b","A","B","j","backspace","space","k","h","l"]);var a=this.mushraAudioControl.getConditions();for(i=0;i<a.length;++i)Mousetrap.unbind(String(i+1))},FilePlayerController.prototype.bind=function(){var a=this.filePlayer.getStimuli();for(i=0;i<a.length;++i)!function(a){Mousetrap.bind(String(a+1),function(){$("#playCondition"+a).click()})}(i);Mousetrap.bind(["space"],function(a){$("#pause").click()})},FilePlayerController.prototype.unbind=function(){var a=this.filePlayer.getStimuli();for(i=0;i<a.length;++i)Mousetrap.unbind(String(i+1));Mousetrap.unbind(["space"])},InputControl.prototype.bind=function(){},InputControl.prototype.unbind=function(){},MushraAudioControlInputController.prototype.bind=function(){var a=this.mushraAudioControl.getConditions();Mousetrap.bind(["r","0"],function(){$("#buttonReference").click()}),Mousetrap.bind(["backspace"],function(){$("#buttonStop").click()}),Mousetrap.bind(["space"],function(){for(var b=!1,c=0;c<a.length;c++){if("true"==$("#buttonConditions"+c).attr("active")){1!=this.mushraAudioControl.audioPlaying&&this.mushraAudioControl.setPosition(this.mushraAudioControl.audioLoopStart),$("#buttonConditions"+c).click(),b=!1;break}if("true"==$("#buttonReference").attr("active")){1!=this.mushraAudioControl.audioPlaying&&this.mushraAudioControl.setPosition(this.mushraAudioControl.audioLoopStart),$("#buttonReference").click(),b=!1;break}b=!0}1==b&&$("#buttonReference").click()}.bind(this));var b=this.mushraAudioControl.getDuration();for(this.looping&&(Mousetrap.bind(["a"],function(){this.pageManager.getCurrentPage().setLoopStart()}),Mousetrap.bind(["b"],function(){this.pageManager.getCurrentPage().setLoopEnd()}),Mousetrap.bind(["B"],function(){this.mushraAudioControl.setLoopEnd(b)}.bind(this)),Mousetrap.bind(["A"],function(){this.mushraAudioControl.setLoopStart(0)}.bind(this))),i=0;i<a.length;++i)!function(b){Mousetrap.bind(String(b+1),function(){$("#buttonConditions"+b).click()}),Mousetrap.bind(["l"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions0").click();else if("true"==$("#buttonConditions"+(a.length-1)).attr("active"))$("#buttonReference").click();else for(var b=0;b<a.length-1;++b)if("true"==$("#buttonConditions"+b).attr("active")){var c=b+1;$("#buttonConditions"+c).click();break}}),Mousetrap.bind(["h"],function(){if("true"==$("#buttonReference").attr("active"))$("#buttonConditions"+(a.length-1)).click();else if("true"==$("#buttonConditions0").attr("active"))$("#buttonReference").click();else for(var b=1;b<a.length;++b)if("true"==$("#buttonConditions"+b).attr("active")){var c=b-1;$("#buttonConditions"+c).click();break}}),Mousetrap.bind(["up","j","shift+up","shift+j"],function(b,c){for(addVal=0,-1!=c.indexOf("shift")?addVal=10:addVal=1,j=0;j<a.length;++j){var d=$(".scales").get(j)
;if("true"==$(d).attr("active")){var e=parseInt($(d).val())+addVal;$(d).val(e.toString()),$(d).slider().slider("refresh");break}}return!1}),Mousetrap.bind(["down","k","shift+down","shift+k"],function(b,c){for(addVal=0,-1!=c.indexOf("shift")?addVal=10:addVal=1,j=0;j<a.length;++j){var d=$(".scales").get(j);if("true"==$(d).attr("active")){var e=parseInt($(d).val())-addVal;$(d).val(e.toString()),$(d).slider().slider("refresh");break}}return!1})}(i);document.onkeydown=function(a){a||(a=window.event);var b=a.keyCode;return 8==b&&"TEXTAREA"!=(a.target||a.srcElement).tagName&&"INPUT"!=(a.target||a.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?a.stopPropagation():(alert("prevented"),a.returnValue=!1),!1):32==b&&"TEXTAREA"!=(a.target||a.srcElement).tagName&&"INPUT"!=(a.target||a.srcElement).tagName?(-1==navigator.userAgent.toLowerCase().indexOf("msie")?a.stopPropagation():(alert("prevented"),a.returnValue=!1),!1):void 0}},MushraAudioControlInputController.prototype.unbind=function(){Mousetrap.unbind(["r","0","a","b","A","B","j","backspace","space","k","h","l","up","down"]);var a=this.mushraAudioControl.getConditions();for(i=0;i<a.length;++i)Mousetrap.unbind(String(i+1))},Session.prototype.getTrial=function(a,b){for(var c=0;c<this.trials.length;++c){var d=this.trials[c];if(d.type===a&&d.id===b)return d}return null},Stimulus.prototype.getId=function(){return this.id},Stimulus.prototype.getAudioBuffer=function(){return this.audioBuffer},Stimulus.prototype.setAudioBuffer=function(a){this.audioBuffer=a},Stimulus.prototype.getFilepath=function(){return this.filepath},FilePlayer.prototype.init=function(){if(this.genericAudioControl.initAudio(),1!=this.hideProgressBar)for(var a=0;a<this.stimuli.length;++a)TolitoProgressBar(this.progressBars[a].attr("id")).setOuterTheme("a").setInnerTheme("b").isMini(!0).setMax(100).setStartFrom(0).setInterval(0).showCounter(!1).build()},FilePlayer.prototype.free=function(){this.genericAudioControl.freeAudio()},FilePlayer.prototype.load=function(){},FilePlayer.prototype.renderElement=function(a,b){var c=$('<button data-role="button" id="playCondition'+b+'" name="'+b+'">'+this.localizer.getFragment(this.language,"playButton")+"</button>");c.bind("click",function(a,b){this.genericAudioControl.play(parseInt(a.target.name))}.bind(this));var d=$('<button data-role="button" id="pause">'+this.localizer.getFragment(this.language,"pauseButton")+"</button>");if(d.bind("click",function(a,b){this.genericAudioControl.pause()}.bind(this)),1!=this.hideProgressBar){var e="FilePlayer_progressbar_"+b,f=$('<div id = "'+e+'" class="fileplayer_progressbar" ></div>');this.progressBars[b]=f}this.hooks[b]=$("<td></td>"),a.append($("<table></table>").append($("<tr></tr>").append($("<td></td>").append(c),$("<td></td>").append(d),$("<td></td>").append(f),this.hooks[b])))},FilePlayer.prototype.render=function(a){var b=$('<table align="center" class="default_padding"></table>');a.append(b);for(var c=0;c<this.stimuli.length;++c){var d=$("<tr></tr>");b.append(d);var e=$("<td></td>");this.renderElement(e,c),d.append(e)}},FilePlayer.prototype.getHook=function(a){return this.hooks[a]},FilePlayer.prototype.getStimuli=function(){return this.stimuli},LikertScale.prototype.enable=function(){$("input[name="+this.prefix+"_response]").checkboxradio("enable")},LikertScale.prototype.render=function(a){this.group=$("<fieldset data-role='controlgroup' data-type='horizontal'></fieldset>"),a.append(this.group),this.elements=[];var b;if(null!=this.responseConfig){for(b=0;b<this.responseConfig.length;++b){var c=this.responseConfig[b],d="";c.img&&(d="<img id='"+this.prefix+"_response_img_"+b+"' src='"+c.img+"'/><br/>");var e=$("<input type='radio' data-mini='false' value='"+c.value+"' name='"+this.prefix+"_response' id='"+this.prefix+"_response_"+b+"'/>         <label for='"+this.prefix+"_response_"+b+"'><center>"+d+c.label+"</center></label>       ");this.elements[this.elements.length]=e,this.group.append(e)}this.group.change(function(){var a=!1;for(b=0;b<this.elements.length;++b)!0===a?$("#"+this.prefix+"_response_img_"+b).attr("src",this.responseConfig[b].img):$("#"+this.prefix+"_response_"+b+":checked").val()?(a=!0,$("#"+this.prefix+"_response_img_"+b).attr("src",this.responseConfig[b].imgSelected)):$("#"+this.prefix+"_response_img_"+b).attr("src",this.responseConfig[b].imgHigherResponseSelected);this.callback&&this.callback(this.prefix)}.bind(this))}this.initDisabled&&this.group.children().attr("disabled","disabled")},Localizer.prototype.initializeNLSFragments=function(a){this.nlsFragments=a},Localizer.prototype.addFragment=function(a,b,c){this.nlsFragments[a]||(this.nlsFragments[a]=new Object),this.nlsFragments[a][b]=c},Localizer.prototype.getFragment=function(a,b){return this.nlsFragments[a][b]},Localizer.prototype.checkLocalization=function(){var a=null;for(var b in this.nlsFragments)if(null==a&&(a=b.length),a!=b.length)return!1;return!0},MushraValidator.prototype.checkSamplerate=function(a,b){return a==b.getAudioBuffer().sampleRate||(this.errorHandler.sendError("Sample rate of device and stimulus ("+b.getId()+" is different."),!1)},MushraValidator.prototype.checkNumChannels=function(a,b){return!(a.destination.channelCount<b.getAudioBuffer().numberOfChannels)||(this.errorHandler.sendError("Audio device has not enough channels ("+a.destination.channelCount+") for playing back stimulus "+b.getId()+" ("+b.getAudioBuffer().numberOfChannels+")."),!1)},MushraValidator.prototype.checkNumConditions=function(a){return!(a.length>12)||(this.errorHandler.sendError("Number of conditions must be no more than 12."),!1)},MushraValidator.prototype.checkStimulusDuration=function(a){return!(a.getAudioBuffer().duration>12)||(this.errorHandler.sendError("Duration of stimulus ("+a.getId()+") must not exceed 12s."),!1)},MushraValidator.prototype.checkConditionConsistency=function(a,b){for(var c=a.getAudioBuffer().sampleRate,d=a.getAudioBuffer().length,e=a.getAudioBuffer().numberOfChannels,f=!0,g=0;g<b.length;++g)c!=b[g].getAudioBuffer().sampleRate&&(this.errorHandler.sendError("Reference/Conditions have different sample rates."),f=!1),d!=b[g].getAudioBuffer().length&&(this.errorHandler.sendError("Reference/Conditions have different (sample) lengths."),f=!1),e!=b[g].getAudioBuffer().numberOfChannels&&(this.errorHandler.sendError("Reference/Conditions have different numbers of channels."),f=!1);return f},WaveformVisualizer.prototype.translateOrigToResampled=function(a){return Number.parseInt(this.resampledSamples.length/this.avgOriginalSamples.length*a)},WaveformVisualizer.prototype.resample=function(){if(this.resampledSamples=[],0==this.showWaveform)for(var a=0;a<this.canvas.width;a++)this.resampledSamples[a]=.3;else for(var b=Math.ceil(this.avgOriginalSamples.length/this.canvas.width),c=0,d=0;d<this.avgOriginalSamples.length;d+=b){for(var e=0,f=0;f<b;f++)e+=Math.abs(this.avgOriginalSamples[f+d]);var g=Math.abs(e*(1/b));this.resampledSamples[c]=g,c++}this.currentPosition=0,this.leftRegionPosition=0,this.rightRegionPosition=this.resampledSamples.length},WaveformVisualizer.prototype.scaleToHeight=function(){var a=0;if(this.scaledToHeight=0,0==this.showWaveform)a=this.resampledSamples[0],this.scaledToHeight=this.canvas.height/a;else{for(var b=0;b<this.resampledSamples.length;b++)a<this.resampledSamples[b]&&(a=this.resampledSamples[b]);this.scaledToHeight=this.canvas.height/a}},WaveformVisualizer.prototype.renderSlider=function(){this.parentSlider.append(this.slider),$.mobile.activePage.trigger("create"),noUiSlider.create(this.slider.get(0),{connect:!0,range:{min:0,max:this.stimulus.audioBuffer.length},start:[0,this.stimulus.audioBuffer.length],step:1,margin:25e3});var a=this.stimulus.audioBuffer.sampleRate;this.slider.get(0).noUiSlider.on("update",function(b,c){var d=Math.floor(b[0]/a*100)/100,e=Math.floor(b[1]/a*100)/100;$("#lowerLim").val(d.toFixed(2)),$("#upperLim").val(e.toFixed(2));var f=parseInt(b[0]),g=parseInt(b[1]);this.mushraAudioControl.setLoop(f,g),g<this.currentPosition/this.scale&&this.mushraAudioControl.setPosition(parseInt(this.rightRegionPosition/this.scale))}.bind(this))},WaveformVisualizer.prototype.renderTable=function(){var a=$("<tr valign='bottom'></tr>");this.table.append(a);var b=$("<td id='sliderLim'></td>"),c=$("<td></td>"),d=$("<td id='sliderLim'></td>");a.append(b),a.append(c),a.append(d);var e=$("     <td>     </td>   ");e.append(this.parentWavesurfer),e.append(this.parentSlider),c.append(e),e.css("width",c.width().toString());var f=$('<div id=\'div_lower_limit\'><input type="text" name="name" id="lowerLim" class="limits" data-inline="true" data-mini="true"disabled="disabled"></input></div>'),g=$('<div id=\'div_upper_limit\'><input type="text" name="name" id="upperLim" class="limits" data-inline="true" data-mini="true"disabled="disabled"></input></div>');b.append(f),d.append(g)},WaveformVisualizer.prototype.create=function(){this.enableLooping&&(this.renderTable(),this.renderSlider()),this.canvas.style.left=this.parent.get(0).style.left,this.canvas.style.top=this.parent.get(0).style.top,this.canvas.style.position="relative",this.canvas.style.zIndex=0,this.canvas.setAttribute("id","canvas"),this.parentWavesurfer.append(this.canvas),this.canvas.height=this.parentWavesurfer.height(),this.canvas.width=this.parentWavesurfer.width(),this.scale=this.canvas.offsetWidth/this.resampledSamples.length,this.resample(),this.scaleToHeight(),this.regionStart=0,this.regionWidth=this.canvas.offsetWidth,this.canvas.addEventListener("click",function(a){if(void 0!=a.x)var b=this.calculateRegion(a.x);else var b=this.calculateRegion(a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);this.enableLooping?this.leftRegionPosition!=b.left?this.mushraAudioControl.setLoopStart(parseInt(b.left/this.scale)):this.rightRegionPosition!=b.right&&this.mushraAudioControl.setLoopEnd(parseInt(b.right/this.scale+b.left/this.scale)):this.leftRegionPosition!=b.left?this.mushraAudioControl.setPosition(parseInt(b.left/this.scale)):this.rightRegionPosition!=b.right&&this.mushraAudioControl.setPosition(parseInt(b.right/this.scale+b.left/this.scale))}.bind(this)),this.refresh()},WaveformVisualizer.prototype.draw=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(0,this.canvas.height/2),this.context.fillStyle="rgba(0, 0, 0, 0.1)",this.context.fillRect(this.leftRegionPosition,-1*this.canvas.height/2,this.rightRegionPosition-this.leftRegionPosition,2*this.canvas.height);var a=this.leftRegionPosition>0||this.rightRegionPosition<this.resampledSamples.length,b=0;this.context.beginPath(),a?this.context.strokeStyle="#808080":0!=this.currentPosition?b=0:(this.context.strokeStyle="#F8DEBD",b=1);for(var c=0;c<this.resampledSamples.length;c++)0==b&&c>=this.leftRegionPosition?(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#ED8C01",b=1):1==b&&c>this.currentPosition?(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#F8DEBD",b=2):2==b&&c>this.rightRegionPosition&&(this.context.stroke(),this.context.beginPath(),this.context.strokeStyle="#808080",b=3),this.context.moveTo(c,-1*this.resampledSamples[c]*this.scaledToHeight/2),this.context.lineTo(c,this.resampledSamples[c]*this.scaledToHeight/2);this.context.stroke(),this.context.translate(0,-this.canvas.height/2)},WaveformVisualizer.prototype.refresh=function(){this.draw()},WaveformVisualizer.prototype.setWidth=function(a){this.canvas.width=a,this.resample(),this.scaleToHeight(),this.refresh()},WaveformVisualizer.prototype.setHeight=function(a){this.canvas.height=a,this.resample(),this.scaleToHeight(),this.refresh()},WaveformVisualizer.prototype.calculateRegion=function(a){var b={left:this.leftRegionPosition,right:this.rightRegionPosition},c=a-(this.canvas.offsetLeft+this.canvas.offsetParent.offsetLeft);return c<this.leftRegionPosition+(this.rightRegionPosition-this.leftRegionPosition)/2?(b.left=c,b.right=this.rightRegionPosition-this.leftRegionPosition):(b.left=this.leftRegionPosition,b.right=c-this.leftRegionPosition),b},WaveformVisualizer.prototype.setLeftRegionPosition=function(a){this.leftRegionPosition=this.translateOrigToResampled(a)},WaveformVisualizer.prototype.setRightRegionPosition=function(a){this.rightRegionPosition=this.translateOrigToResampled(a)},WaveformVisualizer.prototype.setCurrentPosition=function(a){this.currentPosition=this.translateOrigToResampled(a),this.currentPosition<this.leftRegionPosition&&(this.currentPosition=this.leftRegionPosition),this.currentPosition>this.rightRegionPosition&&(this.currentPosition=this.rightRegionPosition),this.draw()},WaveformVisualizer.prototype.load=function(){$("#upperLim").parent().css("opacity","1"),$("#lowerLim").parent().css("opacity","1"),$("#div_lower_limit").css("opacity","1"),$("#div_upper_limit").css("opacity","1")},nls.en=new Object,nls.de=new Object,nls.fr=new Object,nls.en.nextButton="Next",nls.en.previousButton="Previous",nls.en.playButton="Play",nls.en.stopButton="Stop",nls.en.pauseButton="Pause",nls.en.sendButton="Send Results",nls.de.nextButton="Nchste Seite",nls.de.previousButton="Vorherige Seite",nls.de.playButton="Start",nls.de.stopButton="Stopp",nls.de.pauseButton="Pause",nls.de.sendButton="Ergebnisse senden",nls.fr.nextButton="Suivant",nls.fr.previousButton="Prcdent",nls.fr.playButton="Play",nls.fr.stopButton="Stop",nls.fr.pauseButton="Pause",nls.fr.sendButton="Envoyer les rsultats",nls.en.excellent="Excellent",nls.en.good="Good",nls.en.fair="Fair",nls.en.poor="Poor",nls.en.bad="Bad",nls.en.reference="Reference",nls.en.cond="Cond.",nls.en[35]="Anchor35",nls.en[75]="Anchor75",nls.de.excellent="Excellent",nls.de.good="Good",nls.de.fair="Fair",nls.de.poor="Poor",nls.de.bad="Bad",nls.de.reference="Reference",nls.de.cond="Cond.",nls.de[35]="Anchor35",nls.de[75]="Anchor75",nls.fr.excellent="Excellent",nls.fr.good="Bien",nls.fr.fair="Correct",nls.fr.poor="Faible",nls.fr.bad="Mauvais",nls.fr.reference="Rfrence",nls.fr.cond="Cond.",nls.fr[35]="Ancre35",nls.fr[75]="Ancre75",nls.en.imperceptible="Imperceptible",nls.en.perceptible="Perceptible, but not annoying",nls.en.slightly="Slightly annoying",nls.en.annoying="Annoying",nls.en.very="Very annoying",nls.de.imperceptible="Imperceptible",nls.de.perceptible="Perceptible, but not annoying",nls.de.slightly="Slightly annoying",nls.de.annoying="Annoying",nls.de.very="Very annoying",nls.fr.imperceptible="Dgradation imperceptible",nls.fr.perceptible="Perceptible, mais non gnante",nls.fr.slightly="Lgrement gnante",nls.fr.annoying="Dgradation gnante",nls.fr.very="Dgradation trs gnante",nls.en.quest="Which item is the reference?",nls.de.quest="Welches Stck ist die Referenz?",nls.fr.quest="Quel item est la rfrence?",nls.en.results="Your results:",nls.de.results="Die Ergebnisse:",nls.fr.results="Vos rsultats:",nls.en.attending="Thank you for your participation!",nls.de.attending="Vielen Dank fr die Teilnahme!",nls.fr.attending="Merci pour votre participation!",BS1116Page.prototype.getName=function(){return this.pageConfig.name},BS1116Page.prototype.init=function(){this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,[this.condition],this.errorHandler,!1,!1),this.mushraAudioControl.addEventListener(function(a){"stopTriggered"==a.name&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating0").slider("disable"),$("#rating0").attr("active","false"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating1").slider("disable"),$("#rating1").attr("active","false"),$("#buttonConditions1").attr("active","false")),$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonStop").focus(),$("#buttonStop").attr("active","true"))}.bind(this))},BS1116Page.prototype.render=function(a){var b=$("<div></div>");a.append(b);var c;c=null===this.pageConfig.content?"":this.pageConfig.content;var d=$("<p>"+c+"</p>");b.append(d);var e=$("<table id='main' align='center'></table>");b.append(e);var f=$("<tr id='trWs'></tr>");e.append(f);var g=$("     <td class='stopButton' id='tdStopButton'>       <button data-role='button' data-inline='true' id='buttonStop' class='center' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");f.append(g);var h=$("<td></td>");f.append(h),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",h,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load();var i=$("<tr></tr>"),j=$("<td id='td_Mushra' colspan='2'></td>");i.append(j),e.append(i);var k=$("<table id='tableBS1116'></table>"),l=$("<tr><td>A ("+this.pageManager.getLocalizer().getFragment(this.language,"reference")+") </td><td></td><td>B</td><td>C</td></tr>");k.append(l);var m=$("<tr></tr>"),n=$("<td id='tdPlayButton' ><button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(n);var o=$("<td id='BS1116conditionNameScale'></td>");m.append(o);var p=$("<td><button data-theme='a' id='buttonConditions0' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackB()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(p);var q=$("<td><button data-theme='a' id='buttonConditions1' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackC()' >"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(q),k.append(m);var r=$("<tr id='tr_ConditionRatings'></tr>");k.append(r);var s=$("<td id='refCanvas'></td>");r.append(s);var t=$("<td id='spaceForScale'></td>");r.append(t);for(var u=0;u<2;++u){var v=$("<td class='spaceForSlider'>       <span><input type='range'  class='scales' id='rating"+u+"' value='5' min='1' max='5' step='0.01' data-vertical='true' data-highlight='true' style='display : inline-block; float : none;'/></span>     </td>");$(".ui-slider-handle").unbind("keydown"),r.append(v)}j.append(k),this.bacic=new BS1116AudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.bacic.bind()},BS1116Page.prototype.pause=function(){this.mushraAudioControl.pause()},BS1116Page.prototype.setLoopStart=function(){var a=document.getElementById("slider"),b=this.mushraAudioControl.audioCurrentPosition,c=parseFloat(a.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(b,c)},BS1116Page.prototype.setLoopEnd=function(){var a=document.getElementById("slider"),b=parseFloat(a.noUiSlider.get()[0]),c=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(b,c)},BS1116Page.prototype.renderCanvas=function(a){parent=$("#"+a);var b=document.createElement("canvas");b.style.position="absolute",b.style.left=0,b.style.top=0,b.style.zIndex=0,b.setAttribute("id","BS116canvas"),parent.get(0).appendChild(b),$("#BS116canvas").offset({top:$("#refCanvas").offset().top,left:$("#refCanvas").offset().left}),b.height=parent.get(0).offsetHeight-(parent.get(0).offsetHeight-$("#tr_ConditionRatings").height()),b.width=parent.get(0).offsetWidth,$(".scales").siblings().css("zIndex","1"),$(".scales").slider("disable");var c=b.getContext("2d"),d=$(".scales").prev().offset().top-$(".scales").parent().offset().top,e=$(".scales").parent().get(0).offsetTop+parseInt($(".scales").css("borderTopWidth"),10)+d,f=$(".scales").prev().height(),g=$("#spaceForScale").offset().left-$("#spaceForScale").parent().offset().left+1.5*c.measureText("Perceptible, but not annoying    4").width,h=-$("#tableBS1116").offset().left-($("#BS116canvas").offset().left-$("#tableBS1116").offset().left),i=$(".scales").first().prev().children().eq(0).offset().left+h,j=$(".scales").last().offset().left-$("#tableBS1116").offset().left+$(".scales").last().width()/2;c.beginPath(),c.lineWidth="1.5",c.moveTo(g,e),c.lineTo(j,e),c.stroke();for(var k=[.25,.5,.75],l=0;l<k.length;++l){c.beginPath(),c.lineWidth="1.5",c.moveTo(g,f*k[l]+e),c.lineTo(i,f*k[l]+e),c.stroke();var m=null;$(".scales").each(function(a){var b=$(this).prev().first();a>0&&(c.beginPath(),c.lineWidth="1.5",c.moveTo(m,f*k[l]+e),c.lineTo(b.offset().left+h,f*k[l]+e),c.stroke()),m=b.offset().left+b.width()+h+1})}c.beginPath(),c.moveTo(g,f+e),c.lineTo(j,f+e),c.stroke(),c.font="1.25em Calibri",c.textBaseline="middle",c.textAlign="center";$("#refCanvas").width(),$("#spaceForScale").width(),c.measureText("Perceptible, but not annoying    4 ").width;c.font="1em Calibri",c.textAlign="right";var n=g-.25*c.measureText("Perceptible, but not annoying    4").width;c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"imperceptible")+"    5",n,e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"perceptible")+"    4",n,.25*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"slightly")+"    3",n,.5*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"annoying")+"    2",n,.75*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"very")+"    1",n,f+e)},BS1116Page.prototype.cleanButtons=function(){"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating0").slider("disable"),$("#rating0").attr("active","false"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#rating1").slider("disable"),$("#rating1").attr("active","false"),$("#buttonConditions1").attr("active","false"))},BS1116Page.prototype.btnCallbackReference=function(){this.currentItem="ref";var a=$("#buttonReference").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonReference").focus(),$("#buttonReference").attr("active","true"))},BS1116Page.prototype.btnCallbackB=function(){this.currentItem="B";var a=$("#buttonConditions0").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(0),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#rating0").slider("enable"),$("#rating0").attr("active","true"),$("#buttonConditions0").focus(),$("#buttonConditions0").attr("active","true"))},BS1116Page.prototype.btnCallbackC=function(){this.currentItem="C";var a=$("#buttonConditions1").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(1),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#rating1").slider("enable"),$("#rating1").attr("active","true"),$("#buttonConditions1").focus(),$("#buttonConditions1").attr("active","true"))},BS1116Page.prototype.load=function(){if(this.startTimeOnPage=new Date,this.renderCanvas("tableBS1116"),0!==this.ratings.length)for(var a=$(".scales"),b=0;b<a.length;++b)$(".scales").eq(b).val(this.ratings[b].value).slider("refresh");this.mushraAudioControl.initAudio();this.loop.start,this.waveformVisualizer.stimulus.audioBuffer.sampleRate,this.loop.end,this.waveformVisualizer.stimulus.audioBuffer.sampleRate;null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))};BS1116Page.prototype.save=function(){this.bacic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener),this.mushraAudioControl.freeAudio();var a=$(".scales");this.ratings=[];for(var b=0;b<a.length;++b)this.ratings[b]={name:a[b].name,value:a[b].value};this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},BS1116Page.prototype.store=function(){var a=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===a&&(a=new Trial,a.type=this.pageConfig.type,a.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=a);var b=new BS1116Rating;b.reference=this.reference.getId(),b.nonReference=this.condition.getId(),0===this.mushraAudioControl.getReferenceIndexOfConditions()?(b.referenceScore=this.ratings[0].value,b.nonReferenceScore=this.ratings[1].value):(b.nonReferenceScore=this.ratings[0].value,b.referenceScore=this.ratings[1].value),b.time=this.time,a.responses[a.responses.length]=b},BS1116PageManager.prototype.createPages=function(a,b,c,d,e,f,g,h,i){this.conditions=[];for(var j in c.stimuli)this.conditions[this.conditions.length]=new Stimulus(j,c.stimuli[j]);this.reference=new Stimulus("reference",c.reference),shuffle(this.conditions);for(var k=0;k<this.conditions.length;++k){var l=new BS1116Page(this.reference,this.conditions[k],a,b,d,e,f,g,c,h,i);a.addPage(l)}},FinishPage.prototype.getName=function(){return this.pageConfig.name},FinishPage.prototype.storeParticipantData=function(){var a;for(a=0;a<this.pageConfig.questionnaire.length;++a){var b=this.pageConfig.questionnaire[a];this.session.participant.name[this.session.participant.name.length]=b.name,$("#"+b.name).val()?this.session.participant.response[this.session.participant.response.length]=$("#"+b.name).val():this.session.participant.response[this.session.participant.response.length]=$("input[name='"+b.name+"__response']:checked").val()}},FinishPage.prototype.sendResults=function(){1==this.dataSender.send(this.session)&&this.errorDiv.text("An error occured while sending your data to the server! Please contact the experimenter."),clearInterval(this.interval)},FinishPage.prototype.render=function(a){a.append(this.pageConfig.content);var b=$("<table align='center'></table>");a.append(b);var c;for(c=0;c<this.pageConfig.questionnaire.length;++c){var d=this.pageConfig.questionnaire[c];if("text"===d.type)b.append($("<tr><td><strong>"+d.label+"</strong></td><td><input id='"+d.name+"' /></td></tr>"));else if("number"===d.type)b.append($("<tr><td><strong>"+d.label+"</strong></td><td><input id='"+d.name+"' min='"+d.min+"' max='"+d.max+"' value='"+d.default+"' data-inline='true'/></td></tr>"));else if("likert"===d.type){this.likert=new LikertScale(d.response,d.name+"_");var e=$("<td></td>");b.append($("<tr></tr>").append($("<td><strong>"+d.label+"</strong></td>"),e)),this.likert.render(e)}else"long_text"===d.type&&b.append($("<tr><td id='labeltd' style='vertical-align:top; padding-top:"+$("#feedback").css("margin-top")+"'><strong>"+d.label+"</strong></td><td><textarea name='"+d.name+"' id='"+d.name+"'></textarea></td></tr>"));console.log(d)}var f=$("<button id='send_results' data-role='button' data-inline='true' disabled='disabled'>"+this.pageManager.getLocalizer().getFragment(this.language,"sendButton")+"</button>");f.bind("click",function(a,b){this.storeParticipantData(),this.sendResults(),$("#popupDialog").popup("open")}.bind(this)),a.append(f),$("#popHeader").text(this.pageManager.getLocalizer().getFragment(this.language,"attending"));var g,h,b=$("<table align='center'> </table>"),i=document.createElement("tr"),j=$("<th colspan='2' align='center'> </th>");$(j).append(this.pageConfig.popupContent),$(b).append(j),$(b).append(i);var k,l,m;if(this.pageConfig.showResults){th=$("<th colspan='3'> </th>"),$(th).append($("<h3>"+this.pageManager.getLocalizer().getFragment(this.language,"results")+"</h3>")),$(i).append(th);var n=this.session.trials;for(c=0;c<n.length;++c){var o=n[c];if("mushra"===o.type){g=document.createElement("tr"),k=$("<th colspan='2'></th>"),$(k).append(o.id+" (MUSHRA)"),$(g).append(k),$(b).append(g);for(var p=o.responses,q=0;q<p.length;++q){h=document.createElement("tr"),l=document.createElement("td"),m=document.createElement("td"),l.width="50%",m.width="50%";var r=p[q];$(l).append(r.stimulus+": "),$(m).append(r.score),$(h).append(l),$(h).append(m),$(b).append(h)}trEmpty=$("<tr height='8px'></tr>"),$(b).append(trEmpty)}else if("paired_comparison"===o.type){trPaired=document.createElement("tr"),k=$("<th colspan='2'></th>"),$(k).append(o.id+" (Paired Comparison)"),$(trPaired).append(k),$(b).append(trPaired);var q;for(q=0;q<o.responses.length;++q){trPC=document.createElement("tr"),tdPCReference=document.createElement("td"),tdPCres=document.createElement("td");var s=o.responses[q];$(tdPCres).append(s.answer),$(tdPCReference).append(s.nonReference),$(trPC).append(tdPCReference),$(trPC).append(tdPCres),$(b).append(trPC)}trEmpty=$("<tr height='8px'></tr>"),$(b).append(trEmpty)}else if("bs1116"===o.type){trPaired=document.createElement("tr"),k=$("<th colspan='2'></th>"),$(k).append(o.id+" (BS1116)"),$(trPaired).append(k),$(b).append(trPaired);var q;for(q=0;q<o.responses.length;++q){var s=o.responses[q];trBS1=document.createElement("tr"),trBS2=document.createElement("tr"),tdBSReference=document.createElement("td"),tdBSRefValue=document.createElement("td"),tdBSCondition=document.createElement("td"),
tdBSConValue=document.createElement("td"),$(tdBSReference).append(s.reference+": "),$(tdBSRefValue).append(s.referenceScore),$(trBS1).append(tdBSReference),$(trBS1).append(tdBSRefValue),$(tdBSCondition).append(s.nonReference+": "),$(tdBSConValue).append(s.nonReferenceScore),$(trBS2).append(tdBSCondition),$(trBS2).append(tdBSConValue),trEmpty=$("<tr height='5px'></tr>"),$(b).append(trBS1),$(b).append(trBS2),$(b).append(trEmpty)}trEmpty=$("<tr height='3px'></tr>"),$(b).append(trEmpty)}else if("likert_multi_stimulus"===o.type){trLMSH=document.createElement("tr"),k=$("<th colspan='2'></th>"),$(k).append(o.id+" (LMS)"),$(trLMSH).append(k),$(b).append(trLMSH);var q;for(q=0;q<o.responses.length;++q)trLMS=document.createElement("tr"),tdStimulus=document.createElement("td"),tdRating=document.createElement("td"),$(tdStimulus).append(o.responses[q].stimulus+": "),$(tdRating).append(o.responses[q].stimulusRating),$(trLMS).append(tdStimulus),$(trLMS).append(tdRating),$(b).append(trLMS)}else if("likert_single_stimulus"===o.type){trLSSH=document.createElement("tr"),k=$("<th colspan='2'></th>"),$(k).append(o.id+" (LSS)"),$(trLSSH).append(k),$(b).append(trLSSH);var q;for(q=0;q<o.responses.length;++q){trLSS=document.createElement("tr"),tdStimuli=document.createElement("td"),tdRating=document.createElement("td"),$(tdStimuli).append(o.responses[q].stimulus+": ");for(var t=o.responses[q].stimulusRating[0],u=1;u<o.responses[q].stimulusRating.length;++u)t+=", "+o.responses[q].stimulusRating[u];$(tdRating).append(t),$(trLSS).append(tdStimuli),$(trLSS).append(tdRating),$(b).append(trLSS)}}}}1==this.pageConfig.showErrors&&$("#popupResultsContent").append(this.errorDiv),$("#popupResultsContent").append(b)},FinishPage.prototype.load=function(){$("#labeltd").css("padding-top",$("#feedback").css("margin-top")),this.pageConfig.questionnaire.length>0?this.interval=setInterval(function(){var a,b=0;for(a=0;a<this.pageConfig.questionnaire.length;++a){var c=this.pageConfig.questionnaire[a];"text"===c.type?($("#"+c.name).val()||1==c.optional)&&++b:"number"===c.type?($("#"+c.name).val()||1==c.optional)&&++b:"likert"===c.type?(this.likert&&$("input[name='"+c.name+"__response']:checked").val()||1==c.optional)&&++b:"long_text"===c.type&&($("#"+c.name).val()||1==c.optional)&&++b,b==this.pageConfig.questionnaire.length?$("#send_results").removeAttr("disabled"):a+1==this.pageConfig.questionnaire.length&&b!=this.pageConfig.questionnaire.length&&$("#send_results").is(":enabled")&&$("#send_results").attr("disabled",!0)}}.bind(this),50):$("#send_results").removeAttr("disabled")},GenericPage.prototype.getName=function(){return this.title},GenericPage.prototype.render=function(a){a.append(this.content)},GenericPage.prototype.save=function(){},LikertMultiStimulusPage.prototype.getName=function(){return this.pageConfig.name},LikertMultiStimulusPage.prototype.init=function(a){this.likerts=[];var b=function(a){this.ratingMap[a]=!0,Object.keys(this.ratingMap).length==this.stimuli.length&&this.pageTemplateRenderer.unlockNextButton()}.bind(this);!1===this.pageConfig.mustRate&&(b=!1);for(var c=0;c<this.stimuli.length;++c)this.likerts[c]=new LikertScale(this.pageConfig.response,c+"_",this.pageConfig.mustPlayback,b);this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,this.stimuli,this.errorHandler,this.language,this.pageManager.getLocalizer()),this.pageConfig.mustPlayback&&this.filePlayer.genericAudioControl.addEventListener(function(a){a.name==this.pageConfig.mustPlayback&&this.likerts[a.index].enable()}.bind(this))},LikertMultiStimulusPage.prototype.render=function(a){var b=$("<div></div>");a.append(b);var c;c=null===this.pageConfig.content?"":this.pageConfig.content;var d=$("<p>"+c+"</p>");b.append(d),this.filePlayer.render(a);for(var e=0;e<this.stimuli.length;++e)this.likerts[e].render(this.filePlayer.getHook(e));this.fpc=new FilePlayerController(this.filePlayer),this.fpc.bind()},LikertMultiStimulusPage.prototype.load=function(){this.startTimeOnPage=new Date,1==this.pageConfig.mustRate&&this.pageTemplateRenderer.lockNextButton();for(var a=0;a<this.stimuli.length;++a)this.results[a]&&($("input[name='"+this.likerts[a].prefix+"_response'][value='"+this.results[a]+"']").attr("checked","checked"),$("input[name='"+this.likerts[a].prefix+"_response'][value='"+this.results[a]+"']").checkboxradio("refresh"),this.likerts[a].group.change());this.filePlayer.init()},LikertMultiStimulusPage.prototype.save=function(){this.fpc.unbind(),this.time+=new Date-this.startTimeOnPage;for(var a=0;a<this.stimuli.length;++a)this.results[a]=$("input[name='"+this.likerts[a].prefix+"_response']:checked").val();this.filePlayer.free()},LikertMultiStimulusPage.prototype.store=function(a){if(null!=this.pageConfig.response){trial=new Trial,trial.type=this.pageConfig.type,trial.id=this.pageConfig.id;for(var b=0;b<this.stimuli.length;++b){var c=new LikertMultiStimulusRating;c.stimulus=this.stimuli[b].id,void 0==this.results[b]?c.stimulusRating="NA":c.stimulusRating=this.results[b],c.time=this.time,trial.responses[trial.responses.length]=c}this.session.trials[this.session.trials.length]=trial}},LikertSingleStimulusPage.prototype.getName=function(){return this.pageConfig.name},LikertSingleStimulusPage.prototype.init=function(a){this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,[this.stimulus],this.errorHandler,this.language,this.pageManager.getLocalizer(),this.pageConfig.showWaveform);var b=function(a){this.ratingMap[a]=!0,Object.keys(this.ratingMap).length==this.likerts.length&&this.pageTemplateRenderer.unlockNextButton()}.bind(this);if(!1===this.pageConfig.mustRate&&(b=!1),Array.isArray(this.pageConfig.response[0]))for(var c=0;c<this.pageConfig.response.length;++c)this.likerts.push(new LikertScale(this.pageConfig.response[c],c+"_",this.pageConfig.mustPlayback,b));else this.likerts.push(new LikertScale(this.pageConfig.response,"1_",this.pageConfig.mustPlayback,b));this.pageConfig.mustPlayback&&this.filePlayer.genericAudioControl.addEventListener(function(a){a.name==this.pageConfig.mustPlayback&&this.likerts.map(function(a){a.enable()})}.bind(this))},LikertSingleStimulusPage.prototype.render=function(a){var b=$("<div></div>");a.append(b);var c;c=null===this.pageConfig.content?"":this.pageConfig.content;var d=$("<p>"+c+"</p>");if(b.append(d),!0===this.pageConfig.showWaveform){var e=$("<p></p>");b.append(e),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",e,this.stimulus,this.pageConfig.showWaveform,!1,this.filePlayer.genericAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load()}this.filePlayer.render(a),this.likerts.map(function(b){b.render(a)}),this.fpc=new FilePlayerController(this.filePlayer),this.fpc.bind()},LikertSingleStimulusPage.prototype.load=function(){if(this.startTimeOnPage=new Date,1==this.pageConfig.mustRate&&this.pageTemplateRenderer.lockNextButton(),this.results.length>0)for(var a=0;a<this.likerts.length;++a)$("input[name='"+this.likerts[a].prefix+"_response'][value='"+this.results[a]+"']").attr("checked","checked"),$("input[name='"+this.likerts[a].prefix+"_response'][value='"+this.results[a]+"']").checkboxradio("refresh"),this.likerts[a].group.change();this.filePlayer.init()},LikertSingleStimulusPage.prototype.save=function(){this.fpc.unbind(),this.time+=new Date-this.startTimeOnPage;for(var a=0;a<this.likerts.length;++a)this.results[a]=$("input[name='"+this.likerts[a].prefix+"_response']:checked").val();this.filePlayer.free()},LikertSingleStimulusPage.prototype.store=function(a){var b=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===b&&(b=new Trial,b.type=this.pageConfig.type,b.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=b);var c=new LikertSingleStimulusRating;c.stimulus=this.stimulus.id,c.stimulusRating=[];for(var d=0;d<this.likerts.length;++d)void 0===this.results[d]?c.stimulusRating.push("NA"):c.stimulusRating.push(this.results[d]);c.time=this.time,b.responses[b.responses.length]=c},LikertSingleStimulusPageManager.prototype.createPages=function(a,b,c,d,e,f,g,h,i){this.stimuli=[];for(var j in c.stimuli)this.stimuli[this.stimuli.length]=new Stimulus(j,c.stimuli[j]);shuffle(this.stimuli);var k=this.stimuli.length;c.maxStimuli>0&&(k=Math.min(k,c.maxStimuli));for(var l=0;l<k;++l){var m=new LikertSingleStimulusPage(a,b,c,d,e,f,this.stimuli[l],g,h,i);a.addPage(m)}},MushraPage.prototype.getName=function(){return this.pageConfig.name},MushraPage.prototype.init=function(){var a,b;!1!==this.pageConfig.strict&&(this.mushraValidator.checkNumConditions(this.conditions),this.mushraValidator.checkStimulusDuration(this.reference)),this.mushraValidator.checkNumChannels(this.audioContext,this.reference);var c;for(c=0;c<this.conditions.length;++c)this.mushraValidator.checkSamplerate(this.audioContext.sampleRate,this.conditions[c]);this.mushraValidator.checkConditionConsistency(this.reference,this.conditions),this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,this.conditions,this.errorHandler,this.pageConfig.createAnchor35,this.pageConfig.createAnchor70,this.pageConfig.randomize),this.mushraAudioControl.addEventListener(function(d){if("stopTriggered"==d.name){for($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),c=0;c<d.conditionLength;c++)if(b="#buttonConditions"+c,a=$(".scales").get(c),"true"==$(b).attr("active")){$.mobile.activePage.find(b).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(a).slider("disable"),$(a).attr("active","false"),$(b).attr("active","false");break}$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonStop").focus(),$("#buttonStop").attr("active","true")}else if("playReferenceTriggered"==d.name){"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false"));var e;for(e=0;e<d.conditionLength;e++)if(b="#buttonConditions"+e,a=$(".scales").get(e),"true"==$(b).attr("active")){$.mobile.activePage.find(b).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(b).attr("active","false"),$(a).slider("disable"),$(a).attr("active","false");break}$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonReference").focus(),$("#buttonReference").attr("active","true")}else if("playConditionTriggered"==d.name){var f=d.index,g=$(".scales").get(f),h="#buttonConditions"+f;"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false"));var i;for(i=0;i<d.length;i++)if(b="#buttonConditions"+i,a=$(".scales").get(i),"true"==$(b).attr("active")){$.mobile.activePage.find(b).removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$(a).slider("disable"),$(b).attr("active","false"),$(a).attr("active","false");break}$(g).slider("enable"),$(g).attr("active","true"),$.mobile.activePage.find(h).removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find(h).focus(),$(h).attr("active","true")}}.bind(this))},MushraPage.prototype.render=function(a){var b=$("<div></div>");a.append(b);var c;c=null===this.pageConfig.content?"":this.pageConfig.content;var d=$("<p>"+c+"</p>");b.append(d);var e=$("<table id='mainUp'></table>"),f=$("<table id='mainDown' align = 'center'></table>");b.append(e),b.append(f);var g=$("<tr id='trWs'></tr>");e.append(g);var h=$("     <td class='stopButton'>       <button data-role='button' data-inline='true' id='buttonStop' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");g.append(h);var i=$("<td></td>");g.append(i);var j=$("<tr></tr>");f.append(j);var k=$("<td id='td_Mushra' colspan='2'></td>");j.append(k);var l=$("<table id='mushra_items'></table>");k.append(l);var m=$("<tr></tr>");l.append(m);var n=$("<td>"+this.pageManager.getLocalizer().getFragment(this.language,"reference")+"</td>");m.append(n);var o=$("<td id='conditionNameScale'></td>");m.append(o);var p,q=this.mushraAudioControl.getConditions();for(p=0;p<q.length;++p){var r="";!0===this.pageConfig.showConditionNames&&(r="en"==this.language?"<br/>"+q[p].id:"reference"==q[p].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"reference"):"anchor35"==q[p].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"35"):"anchor70"==q[p].id?"<br/>"+this.pageManager.getLocalizer().getFragment(this.language,"70"):"<br/>"+q[p].id),td=$("<td>"+this.pageManager.getLocalizer().getFragment(this.language,"cond")+(p+1)+r+"</td>"),m.append(td)}var s=$("<tr></tr>");l.append(s);var t=$("<td></td>");s.append(t);var u=$("<button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button>");t.append(u);var v=$("<td></td>");for(s.append(v),p=0;p<q.length;++p){td=$("<td></td>");var w=$("<button data-role='button' class='center audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackCondition("+p+");'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button>");w.attr("id","buttonConditions"+p),td.append(w),s.append(td)}var x=$("<tr id='tr_ConditionRatings'></tr>");l.append(x);var y=$("<td id='refCanvas'></td>");x.append(y);var z=$("<td id='spaceForScale'></td>");for(x.append(z),p=0;p<q.length;++p)td=$("<td class='spaceForSlider'>       <span><input type='range' name='"+q[p].getId()+"' class='scales' value='100' min='0' max='100' data-vertical='true' data-highlight='true' style='display : inline-block; float : none;'/></span>     </td>"),$(".ui-slider-handle").unbind("keydown"),x.append(td);this.macic=new MushraAudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.macic.bind(),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",i,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load()},MushraPage.prototype.pause=function(){this.mushraAudioControl.pause()},MushraPage.prototype.setLoopStart=function(){var a=document.getElementById("slider"),b=this.mushraAudioControl.audioCurrentPosition,c=parseFloat(a.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(b,c)},MushraPage.prototype.setLoopEnd=function(){var a=document.getElementById("slider"),b=parseFloat(a.noUiSlider.get()[0]),c=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(b,c)},MushraPage.prototype.btnCallbackReference=function(){this.currentItem="ref";var a=$("#buttonReference").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")))},MushraPage.prototype.btnCallbackCondition=function(a){this.currentItem=a;var b=$("#buttonConditions"+a).text();b==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions"+a).text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):b==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(a),$("#buttonConditions"+a).text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")))},MushraPage.prototype.renderCanvas=function(a){$("#mushra_canvas").remove(),parent=$("#"+a);var b=document.createElement("canvas");b.style.position="absolute",b.style.left=0,b.style.top=0,b.style.zIndex=0,b.setAttribute("id","mushra_canvas"),parent.get(0).appendChild(b),$("#mushra_canvas").offset({top:$("#refCanvas").offset().top,left:$("#refCanvas").offset().left}),b.height=parent.get(0).offsetHeight-(parent.get(0).offsetHeight-$("#tr_ConditionRatings").height()),b.width=parent.get(0).offsetWidth,$(".scales").siblings().css("zIndex","1"),$(".scales").slider("disable");var c=b.getContext("2d"),d=$(".scales").prev().offset().top-$(".scales").parent().offset().top,e=$(".scales").parent().get(0).offsetTop+parseInt($(".scales").css("borderTopWidth"),10)+d,f=$(".scales").prev().height(),g=$("#spaceForScale").offset().left-$("#spaceForScale").parent().offset().left+1.5*c.measureText("100 ").width,h=-$("#mushra_items").offset().left-($("#mushra_canvas").offset().left-$("#mushra_items").offset().left),i=$(".scales").first().prev().children().eq(0).offset().left+h,j=$(".scales").last().offset().left-$("#mushra_items").offset().left+$(".scales").last().width()/2;c.beginPath(),c.moveTo(g,e),c.lineTo(j,e),c.stroke();var k,l=[.2,.4,.6,.8];for(k=0;k<l.length;++k){c.beginPath(),c.moveTo(g,f*l[k]+e),c.lineTo(i,f*l[k]+e),c.stroke();var m=null;$(".scales").each(function(a){var b=$(this).prev().first();a>0&&(c.beginPath(),c.moveTo(m,f*l[k]+e),c.lineTo(b.offset().left+h,f*l[k]+e),c.stroke()),m=b.offset().left+b.width()+h+1})}c.beginPath(),c.moveTo(g,f+e),c.lineTo(j,f+e),c.stroke(),c.font="1.25em Calibri",c.textBaseline="middle",c.textAlign="center";var n=$("#refCanvas").width()+($("#spaceForScale").width()+c.measureText("1 ").width)/2;c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"excellent"),n,.1*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"good"),n,.3*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"fair"),n,.5*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"poor"),n,.7*f+e),c.fillText(this.pageManager.getLocalizer().getFragment(this.language,"bad"),n,.9*f+e),c.font="1em Calibri",c.textAlign="right";var o=g-.25*c.measureText("100 ").width;c.fillText("100",o,e),c.fillText("80",o,.2*f+e),c.fillText("60",o,.4*f+e),c.fillText("40",o,.6*f+e),c.fillText("20",o,.8*f+e),c.fillText("0",o,f+e)},MushraPage.prototype.load=function(){if(this.startTimeOnPage=new Date,this.renderCanvas("mushra_items"),this.mushraAudioControl.initAudio(),0!==this.ratings.length){var a,b=$(".scales");for(a=0;a<b.length;++a)$(".scales").eq(a).val(this.ratings[a].value).slider("refresh")}null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))},MushraPage.prototype.save=function(){this.macic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.freeAudio(),this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener);var a=$(".scales");this.ratings=[];var b;for(b=0;b<a.length;++b)this.ratings[b]={name:a[b].name,value:a[b].value};this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},MushraPage.prototype.store=function(){var a=new Trial;a.type=this.pageConfig.type,a.id=this.pageConfig.id;var b;for(b=0;b<this.ratings.length;++b){var c=this.ratings[b],d=new MUSHRARating;d.stimulus=c.name,d.score=c.value,d.time=this.time,a.responses[a.responses.length]=d}this.session.trials[this.session.trials.length]=a},Page.prototype.getName=function(){},Page.prototype.init=function(a){},Page.prototype.render=function(a){},Page.prototype.load=function(){},Page.prototype.save=function(){},Page.prototype.store=function(a){},PairedComparisonPage.prototype.getName=function(){return this.pageConfig.name},PairedComparisonPage.prototype.init=function(){this.mushraAudioControl=new MushraAudioControl(this.audioContext,this.bufferSize,this.reference,[this.condition],this.errorHandler,!1,!1),this.mushraAudioControl.addEventListener(function(a){"stopTriggered"==a.name&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions1").attr("active","false")),$.mobile.activePage.find("#buttonStop").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$.mobile.activePage.find("#buttonStop").focus(),$("#buttonStop").attr("active","true"))}.bind(this))},PairedComparisonPage.prototype.render=function(a){var b=$("<div></div>");a.append(b);var c;c=null===this.pageConfig.content?"":this.pageConfig.content;var d=$("<p>"+c+"</p>");b.append(d);var e=$("<table id='main' align='center'></table>");b.append(e);var f=$("<tr id='trWs'></tr>");e.append(f);var g=$("     <td class='stopButton'>       <button data-role='button' data-inline='true' id='buttonStop' class='center' onclick='"+this.pageManager.getPageVariableName(this)+".mushraAudioControl.stop();'>"+this.pageManager.getLocalizer().getFragment(this.language,"stopButton")+"</button>     </td>   ");f.append(g);var h=$("<td></td>");f.append(h),this.waveformVisualizer=new WaveformVisualizer(this.pageManager.getPageVariableName(this)+".waveformVisualizer",h,this.reference,this.pageConfig.showWaveform,this.pageConfig.enableLooping,this.mushraAudioControl),this.waveformVisualizer.create(),this.waveformVisualizer.load();var i=$("<tr></tr>");e.append(i);var j=$("<td id='td_AB' colspan='2'></td>");i.append(j);var k=$("<table id='table_ab' class='center'></table>");j.append(k);var l=$("<tr><td>"+this.pageManager.getLocalizer().getFragment(this.language,"reference")+"</td><td>A</td><td>B</td></tr>");k.append(l);var m=$("<tr></tr>");k.append(m);var n=$("<td><button data-theme='a' id='buttonReference' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackReference()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(n);var o=$("<td><button data-theme='a' id='buttonConditions0' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackA()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(o);var p=$("<td><button data-theme='a' id='buttonConditions1' data-role='button' class='audioControlElement' onclick='"+this.pageManager.getPageVariableName(this)+".btnCallbackB()' style='margin : 0 auto;'>"+this.pageManager.getLocalizer().getFragment(this.language,"playButton")+"</button></td>");m.append(p);var q=$("<tr><td  colspan='3'><br/><br/>"+this.pageManager.getLocalizer().getFragment(this.language,"quest")+"</td></tr>");k.append(q);var r=$("<tr></tr>");k.append(r);var s=$("<td  colspan='3'></td>");r.append(s);var t=$("<div id='radio-choice' data-role='controlgroup' data-type='horizontal'>    <input type='radio' name='radio-choice' id='radio-choice-a' value='a'>    <label for='radio-choice-a'>A</label>    <input type='radio' name='radio-choice' id='radio-choice-b' value='b'>    <label for='radio-choice-b'>B</label>  </div>");this.pageConfig.unforced&&t.append($("<input type='radio' name='radio-choice' id='radio-choice-n' value='n'><label for='radio-choice-n'>"+this.pageConfig.unforced+"</label>")),t.find("input[type='radio']").bind("change",function(){this.pageTemplateRenderer.unlockNextButton()}.bind(this)),s.append(t),this.macic=new MushraAudioControlInputController(this.mushraAudioControl,this.pageConfig.enableLooping),this.macic.bind()},PairedComparisonPage.prototype.setLoopStart=function(){var a=document.getElementById("slider"),b=this.mushraAudioControl.audioCurrentPosition,c=parseFloat(a.noUiSlider.get()[1]);this.mushraAudioControl.setLoop(b,c)},PairedComparisonPage.prototype.setLoopEnd=function(){var a=document.getElementById("slider"),b=parseFloat(a.noUiSlider.get()[0]),c=this.mushraAudioControl.audioCurrentPosition;this.mushraAudioControl.setLoop(b,c)},PairedComparisonPage.prototype.pause=function(){this.mushraAudioControl.pause()},PairedComparisonPage.prototype.cleanButtons=function(){"true"==$("#buttonStop").attr("active")&&($.mobile.activePage.find("#buttonStop").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonStop").attr("active","false")),"true"==$("#buttonReference").attr("active")&&($.mobile.activePage.find("#buttonReference").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonReference").attr("active","false")),"true"==$("#buttonConditions0").attr("active")&&($.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions0").attr("active","false")),"true"==$("#buttonConditions1").attr("active")&&($.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-b").addClass("ui-btn-a").attr("data-theme","a"),$("#buttonConditions1").attr("active","false"))},PairedComparisonPage.prototype.btnCallbackReference=function(){this.currentItem="ref";var a=$("#buttonReference").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playReference(),$("#buttonReference").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonReference").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonReference").focus(),$("#buttonReference").attr("active","true"))},PairedComparisonPage.prototype.btnCallbackA=function(){this.currentItem="A";var a=$("#buttonConditions0").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(0),$("#buttonConditions0").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions0").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonConditions0").focus(),$("#buttonConditions0").attr("active","true"))},PairedComparisonPage.prototype.btnCallbackB=function(){this.currentItem="B";var a=$("#buttonConditions1").text();a==this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")?(this.mushraAudioControl.pause(),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton"))):a==this.pageManager.getLocalizer().getFragment(this.language,"playButton")&&($(".audioControlElement").text(this.pageManager.getLocalizer().getFragment(this.language,"playButton")),this.mushraAudioControl.playCondition(1),$("#buttonConditions1").text(this.pageManager.getLocalizer().getFragment(this.language,"pauseButton")),this.cleanButtons(),$.mobile.activePage.find("#buttonConditions1").removeClass("ui-btn-a").addClass("ui-btn-b").attr("data-theme","b"),$("#buttonConditions1").focus(),$("#buttonConditions1").attr("active","true"))},PairedComparisonPage.prototype.load=function(){this.startTimeOnPage=new Date,null===this.choice&&this.pageTemplateRenderer.lockNextButton(),this.mushraAudioControl.initAudio(),"a"===this.choice?($("#radio-choice-a").prop("checked",!0).checkboxradio("refresh"),$("#radio-choice-b").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!1).checkboxradio("refresh")):"b"===this.choice?($("#radio-choice-b").prop("checked",!0).checkboxradio("refresh"),$("#radio-choice-a").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!1).checkboxradio("refresh")):"n"===this.choice&&($("#radio-choice-b").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-a").prop("checked",!1).checkboxradio("refresh"),$("#radio-choice-n").prop("checked",!0).checkboxradio("refresh")),null!==this.loop.start&&null!==this.loop.end&&(this.mushraAudioControl.setLoop(0,0,this.mushraAudioControl.getDuration(),this.mushraAudioControl.getDuration()/this.waveformVisualizer.stimulus.audioBuffer.sampleRate),this.mushraAudioControl.setPosition(0))},PairedComparisonPage.prototype.save=function(){this.macic.unbind(),this.time+=new Date-this.startTimeOnPage,this.mushraAudioControl.removeEventListener(this.waveformVisualizer.numberEventListener),this.mushraAudioControl.freeAudio();var a=$("#radio-choice :radio:checked");this.choice=a.length>0?a[0].value:null,this.loop.start=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopStart),this.loop.end=parseInt(this.waveformVisualizer.mushraAudioControl.audioLoopEnd)},PairedComparisonPage.prototype.store=function(){var a=this.session.getTrial(this.pageConfig.type,this.pageConfig.id);null===a&&(a=new Trial,a.type=this.pageConfig.type,a.id=this.pageConfig.id,this.session.trials[this.session.trials.length]=a);var b=new PairedComparisonChoice;b.reference=this.reference.getId(),b.nonReference=this.condition.getId();var c=0===this.mushraAudioControl.getReferenceIndexOfConditions();"a"===this.choice&&c||"b"===this.choice&&!c?b.answer="correct":b.answer="incorrect",null===this.choice?b.answer="unknown":"n"===this.choice&&(b.answer="undecided"),b.time=this.time,a.responses[a.responses.length]=b},PairedComparisonPageManager.prototype.createPages=function(a,b,c,d,e,f,g,h,i){this.conditions=[];for(var j in c.stimuli)this.conditions[this.conditions.length]=new Stimulus(j,c.stimuli[j]);this.reference=new Stimulus("reference",c.reference),shuffle(this.conditions);for(var k=0;k<this.conditions.length;++k){var l=new PairedComparisonPage(this.reference,this.conditions[k],a,b,d,e,f,g,c,h,i);a.addPage(l)}},SpatialPage.prototype.initScenes=function(){for(var a=0;a<this.pageConfig.views.length;++a){if(this.renderDivs[a]=document.createElement("div"),this.renderDivs[a].setAttribute("id","renderArea"+a),
this.renderDivs[a].setAttribute("style","border = solid"),"front"==this.pageConfig.views[a].view)this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[a]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[a]),this.cameras[a].setPosition(0,this.pageConfig.roomMeasurements[1]/2,800,0,0,0);else if("back"==this.pageConfig.views[a].view)this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[a]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[a]),this.cameras[a].setPosition(0,this.pageConfig.roomMeasurements[1]/2,-800,0,180,0);else if("top"==this.pageConfig.views[a].view)this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[0]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[2]),this.cameras[a]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[a]),this.cameras[a].setPosition(0,500,0,90,180,180);else if("right"==this.pageConfig.views[a].view)this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[a]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[a]),this.cameras[a].setPosition(500,this.pageConfig.roomMeasurements[1]/2,0,0,90,0);else if("left"==this.pageConfig.views[a].view)this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[1]),this.cameras[a]=new Camera(CameraType.ORTHOGRAPHIC,this.renderDivs[a]),this.cameras[a].setPosition(-500,this.pageConfig.roomMeasurements[1]/2,0,0,-90,0);else if("3d"==this.pageConfig.views[a].view){this.renderDivs[a].setAttribute("width",this.pageConfig.roomMeasurements[2]),this.renderDivs[a].setAttribute("height",this.pageConfig.roomMeasurements[1]);var b=this.pageConfig.views[a].position;this.pageConfig.views[a].rotation;this.cameras[a]=new Camera(CameraType.PERSPECTIVE,this.renderDivs[a]),this.cameras[a].setPosition(b[0],b[1],b[2],0,0,0)}this.scenes[a]=new Scene(this.renderDivs[a],this.cameras[a],this.pageConfig,this.pageConfig.views[a]),this.renderDivs[a].onmousedown=function(a){this.page.mouseDown=!0;var b=$(a.target).parent().offset(),c=parseFloat(this.div.getAttribute("width")),d=parseFloat(this.div.getAttribute("height")),e=a.pageX-b.left,f=a.pageY-b.top,g=e-c/2,h=f-d/2;if(null!==this.page.activeResponse)for(var i=this.page.responses[this.page.activeResponse].objects,j=i[0].getCenterPosition(),k=this.scene.transformRelativeCoordinates(g,h,j[0],j[1],j[2]),l=0;l<i.length;++l)i[l].eventOnMouseDown&&i[l].eventOnMouseDown(a,k[0],k[1],k[2])}.bind({page:this,div:this.renderDivs[a],scene:this.scenes[a]}),this.renderDivs[a].onmouseup=function(a){this.page.mouseDown=!1}.bind({page:this}),this.renderDivs[a].onmousemove=function(a){var b=(new Date).getTime();if(b-this.page.time>=this.page.framerate){this.page.time=b,console.log("update");var c=$(a.target).parent().offset(),d=parseFloat(this.div.getAttribute("width")),e=parseFloat(this.div.getAttribute("height")),f=a.pageX-c.left,g=a.pageY-c.top,h=f-d/2,i=g-e/2;if(1==this.page.mouseDown&&null!==this.page.activeResponse)for(var j=this.page.responses[this.page.activeResponse].objects,k=j[0].getCenterPosition(),l=this.scene.transformRelativeCoordinates(h,i,k[0],k[1],k[2]),m=0;m<j.length;++m)j[m].eventOnMouseMove&&"PerspectiveCamera"!=this.scene.camera.type&&j[m].eventOnMouseMove(a,l[0],l[1],l[2])}}.bind({page:this,div:this.renderDivs[a],scene:this.scenes[a]})}for(var a=0;a<this.pageConfig.views.length;++a)this.scenes[a].load();for(var a=0;a<this.pageConfig.objects.length;++a){var c=this.pageConfig.objects[a];if("listener"==c.type)for(var d=0;d<this.pageConfig.views.length;++d)this.scenes[d].addListener(c);else if("custom"==c.type)for(var d=0;d<this.pageConfig.views.length;++d)this.scenes[d].addCustomObject(c)}for(var a=0;a<this.pageConfig.responses.length;++a){var e=this.pageConfig.responses[a];if("localization"==e.type){this.responses[e.name]={objects:[],config:e};for(var d=0;d<this.pageConfig.views.length;++d){var f=new LocalizationObject(e);f.init(this.scenes[d].scene),this.responses[e.name].objects[this.responses[e.name].objects.length]=f}}if("lev"==e.type){this.responses[e.name]={objects:[],config:e};for(var d=0;d<this.pageConfig.views.length;++d){var g=new LEVObject(e);g.init(this.scenes[d].scene),this.responses[e.name].objects[this.responses[e.name].objects.length]=g}}if("asw"==e.type){this.responses[e.name]={objects:[],config:e};for(var d=0;d<this.pageConfig.views.length;++d){e.height=null,e.depth=null;var h=new ASWObject(e);h.init(this.scenes[d].scene),this.responses[e.name].objects[this.responses[e.name].objects.length]=h}}if("hwd"==e.type){this.responses[e.name]={objects:[],config:e};for(var d=0;d<this.pageConfig.views.length;++d){var i=new ASWObject(e);i.init(this.scenes[d].scene),this.responses[e.name].objects[this.responses[e.name].objects.length]=i}}}},SpatialPage.prototype.init=function(){this.initScenes(),this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,this.stimuli,this.errorHandler,this.language,this.pageManager.getLocalizer())},SpatialPage.prototype.render=function(a){var b,c=document.createElement("div");if(void 0!==this.pageConfig.content){b=this.pageConfig.content;var d=document.createElement("div");d.innerHTML=b,c.appendChild(d)}a.append(c);var e=document.createElement("table");e.setAttribute("border","0"),e.setAttribute("align","center"),e.setAttribute("style","margin-top: 0em;");for(var f=document.createElement("tr"),g=0;g<this.stimuli.length;++g){var h=$("<td></td>"),i=$("<div id='spatial_stimuli_"+g+"' class='ui-body ui-body-a ui-corner-all'></div>");h.append(i),this.filePlayer.renderElement(i,g),f.appendChild(h.get(0))}e.appendChild(f),c.appendChild(e);for(var g=0;g<this.pageConfig.responses.length;++g){for(var j=this.pageConfig.responses[g],k=null,l=0;l<this.stimuli.length;++l)if(this.stimuli[l].getId()==j.stimulus){this.stimuli[l],k=l;break}var m="#"+((1<<24)+j.color).toString(16).substr(1);button=$("<button id='"+j.name+"' data-inline='true' style='background-color:#"+((1<<24)+j.color).toString(16).substr(1)+"; background-image:radial-gradient(#ffffff 0%, "+m+" 100%)'>"+j.label+"</button>"),button.on("click",function(){this.page.setBoxShadow(this.page.activeResponse,this.name,"#555555"),this.page.activeResponse=this.name}.bind({page:this,label:j.label,name:j.name,button:button})),$("#spatial_stimuli_"+k).append(button)}var n=document.createElement("table");n.setAttribute("border","0"),n.setAttribute("align","center"),n.setAttribute("style","margin-top: 0em;");for(var o=document.createElement("tr"),g=0;g<this.pageConfig.views.length;++g){var h=document.createElement("td");h.appendChild(this.renderDivs[g]),o.appendChild(h)}n.appendChild(o),c.appendChild(n),this.renderScene(),a.append(c)},SpatialPage.prototype.setBoxShadow=function(a,b,c){null!=a&&(document.getElementById(a).style.boxShadow="0 0 0 white , 0 0 0 white"),document.getElementById(b).style.boxShadow="0 0 30px "+c+" , 0 0 30px "+c},SpatialPage.prototype.renderScene=function(){for(var a=0;a<this.pageConfig.views.length;++a)this.scenes[a].render()},SpatialPage.prototype.store=function(){var a=this.session.getTrial("localization",this.pageConfig.id),b=this.session.getTrial("asw",this.pageConfig.id),c=this.session.getTrial("lev",this.pageConfig.id),d=this.session.getTrial("hwd",this.pageConfig.id);for(key in this.responses)this.responses[key].objects[0]instanceof ASWObject&&0==key.height&&this.responses[key].objects[0].storeValues(b,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof LocalizationObject&&this.responses[key].objects[0].storeValues(a,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof LEVObject&&this.responses[key].objects[0].storeValues(c,this.session,this.pageConfig.id),this.responses[key].objects[0]instanceof ASWObject&&this.responses[key].objects[0].storeValues(d,this.session,this.pageConfig.id)},SpatialPage.prototype.load=function(){this.startTimeOnPage=new Date,this.frameUpdateInterval=setInterval(function(){this.renderScene()}.bind(this),this.framerate),this.filePlayer.init()},SpatialPage.prototype.save=function(){clearInterval(this.frameUpdateInterval),this.time+=new Date-this.startTimeOnPage,this.filePlayer.free()},SpatialPage.prototype.getName=function(){return this.pageConfig.name},VolumePage.prototype.init=function(a){this.filePlayer=new FilePlayer(this.audioContext,this.bufferSize,[this.stimulus],this.errorHandler,this.language,this.pageManager.getLocalizer())},VolumePage.prototype.getName=function(){return this.pageConfig.name},VolumePage.prototype.load=function(){this.filePlayer.init()},VolumePage.prototype.save=function(){this.volume=this.audioContext.volume,this.filePlayer.free()},VolumePage.prototype.gainVolume=function(a){this.audioContext.volume=parseInt(a,10)/100},VolumePage.prototype.render=function(a){var b=$(" <p> "+this.pageConfig.content+" </p>"),c=$("<table width='600' style='margin: 0 auto;'></table>");c.append($("<tr></tr>").append($("<td></td>").append($('<input type="range" name="slider"  min="0" max="100" value="'+100*this.volume+'"  data-highlight="true" onchange = "'+this.pageManager.getPageVariableName(this)+'.gainVolume(this.value)">')))),a.append(b),this.filePlayer.render(a),a.append(c)},CameraType={PERSPECTIVE:0,ORTHOGRAPHIC:1},Camera.prototype.setPosition=function(a,b,c,d,e,f){this.camera.position.x=a,this.camera.position.y=b,this.camera.position.z=c,this.camera.rotation.x=2*d*Math.PI/360,this.camera.rotation.y=2*e*Math.PI/360,this.camera.rotation.z=2*f*Math.PI/360,0==this.type&&(this.camera.up.set(0,1,0),this.camera.lookAt(new THREE.Vector3(0,0,0))),this.camera.updateMatrix()},Camera.prototype.getCameraType=function(){return this.type},Camera.prototype.setCameraPolar=function(a,b,c){if(c<Math.PI-.01&&c>.01){var d=a*Math.sin(c)*Math.cos(b),e=a*Math.sin(c)*Math.sin(b),f=a*Math.cos(c),g=new THREE.Vector3(d,f,e);g.x=0,g.y=100,g.z=0,this.setCamera(d,f,e),this.camera.lookAt(g)}},Camera.prototype.getCamera=function(){return this.camera},Camera.prototype.getCameraR=function(){var a=this.getCameraX(),b=this.getCameraY(),c=this.getCameraZ();return Math.sqrt(Math.pow(a,2)+Math.pow(c,2)+Math.pow(b,2))},Camera.prototype.getCameraPhi=function(){var a=this.getCameraX(),b=(this.getCameraY(),this.getCameraZ());return a>0?Math.atan(b/a):0==a?b<0?-Math.PI/2:Math.PI/2:b<0?Math.atan(b/a)-Math.PI:Math.atan(b/a)+Math.PI},Camera.prototype.getCameraTheta=function(){var a=(this.getCameraX(),this.getCameraY());this.getCameraZ();return Math.acos(a/this.getCameraR())},Camera.prototype.getCameraX=function(){return this.camera.position.x},Camera.prototype.getCameraY=function(){return this.camera.position.y},Camera.prototype.getCameraZ=function(){return this.camera.position.z},Camera.prototype.getCameraRotX=function(){return this.camera.rotation.x},Camera.prototype.getCameraRotY=function(){return this.camera.rotation.y},Camera.prototype.getCameraRotZ=function(){return this.camera.rotation.z},ASWObject.prototype.init=function(a){this.scene=a,this.updateGeometry(),a.add(this.line1),0!=this.height&&a.add(this.line2);for(var b=0;b<this.points.length;++b)a.add(this.points[b])},ASWObject.prototype.update=function(){this.updateGeometry(),this.updateControlPolygon()},ASWObject.prototype.updateGeometry=function(){this.extrudeBend=new THREE.CubicBezierCurve3(new THREE.Vector3(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2]),new THREE.Vector3(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2]),new THREE.Vector3(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2]),new THREE.Vector3(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2]));var a=new THREE.Tube(1,64,20,this.extrudeBend,this.height/2,this.depth/2),b=new THREE.MeshPhongMaterial({color:this.objConfig.color,ambient:this.objConfig.color,opacity:.5,transparent:!0,side:THREE.DoubleSide});this.updateGroup(a,b)},ASWObject.prototype.updateGroup=function(a,b){if(void 0!=this.tmp){null!=this.scene&&this.scene.remove(this.group.children[0]);for(var c=0;c<this.tmp.length;c++)this.group.remove(this.tmp[c])}if(this.tmp[0]=new THREE.Mesh(a,b),this.group.add(this.tmp[0]),null!=this.scene){var d=this.group.children[0];this.scene.add(this.group.children[0]),this.group.children[0]=d}},ASWObject.prototype.updateControlPolygon=function(){if(this.points[0].position.set(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2]),this.points[1].position.set(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2]),this.points[2].position.set(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2]),this.points[3].position.set(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2]),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.pop(),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[0][0],this.controlPoints[0][1],this.controlPoints[0][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[1][0],this.controlPoints[1][1],this.controlPoints[1][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[2][0],this.controlPoints[2][1],this.controlPoints[2][2])),this.geometryLine1.vertices.push(new THREE.Vector3(this.controlPoints[3][0],this.controlPoints[3][1],this.controlPoints[3][2])),this.line1=new THREE.Line(this.geometryLine1,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.line1.geometry.verticesNeedUpdate=!0,0!=this.height&&0!=this.depth){this.midpointOnCurve[0]=.125*this.controlPoints[0][0]+.375*this.controlPoints[1][0]+.375*this.controlPoints[2][0]+.125*this.controlPoints[3][0],this.midpointOnCurve[1]=.125*this.controlPoints[0][1]+.375*this.controlPoints[1][1]+.375*this.controlPoints[2][1]+.125*this.controlPoints[3][1],this.midpointOnCurve[2]=.125*this.controlPoints[0][2]+.375*this.controlPoints[1][2]+.375*this.controlPoints[2][2]+.125*this.controlPoints[3][2],this.derivative[0]=3*(this.controlPoints[0][0]+this.controlPoints[1][0]-this.controlPoints[2][0]-this.controlPoints[3][0]),this.derivative[1]=3*(this.controlPoints[0][1]+this.controlPoints[1][1]-this.controlPoints[2][1]-this.controlPoints[3][1]),this.derivative[2]=3*(this.controlPoints[0][2]+this.controlPoints[1][2]-this.controlPoints[2][2]-this.controlPoints[3][2]);var a=Math.sqrt(Math.pow(this.derivative[0],2)+Math.pow(this.derivative[2],2));this.derivative[0]=this.derivative[0]/a,this.derivative[2]=this.derivative[2]/a,this.controlPoints[5][0]=this.midpointOnCurve[0]+this.derivative[2]*this.depth/2,this.controlPoints[5][1]=this.midpointOnCurve[1],this.controlPoints[5][2]=this.midpointOnCurve[2]-this.derivative[0]*this.depth/2,this.controlPoints[4][0]=this.midpointOnCurve[0],this.controlPoints[4][1]=this.midpointOnCurve[1]+this.height/2,this.controlPoints[4][2]=this.midpointOnCurve[2],this.points[4].position.set(this.controlPoints[4][0],this.controlPoints[4][1],this.controlPoints[4][2]),this.points[5].position.set(this.controlPoints[5][0],this.controlPoints[5][1],this.controlPoints[5][2]),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.pop(),this.geometryLine2.vertices.push(new THREE.Vector3(this.controlPoints[4][0],this.controlPoints[4][1],this.controlPoints[4][2])),this.geometryLine2.vertices.push(new THREE.Vector3(this.midpointOnCurve[0],this.midpointOnCurve[1],this.midpointOnCurve[2])),this.geometryLine2.vertices.push(new THREE.Vector3(this.controlPoints[5][0],this.controlPoints[5][1],this.controlPoints[5][2])),this.line2=new THREE.Line(this.geometryLine2,new THREE.LineBasicMaterial({linewidth:3}),THREE.LineStrip),this.line2.geometry.verticesNeedUpdate=!0}},ASWObject.prototype.eventOnMouseUp=function(a,b,c,d){this.activeObj=null},ASWObject.prototype.eventOnMouseDown=function(a,b,c,d){if(null==b){this.activeObj=null;for(var e=0;e<this.controlPoints.length;++e)this.distance(new THREE.Vector3(this.controlPoints[e][0],c,d),new THREE.Vector3(this.controlPoints[e][0],this.controlPoints[e][1],this.controlPoints[e][2]))<10&&(this.activeObj=e)}else if(null==c){this.activeObj=null;for(var e=0;e<this.controlPoints.length;++e)this.distance(new THREE.Vector3(b,this.controlPoints[e][1],d),new THREE.Vector3(this.controlPoints[e][0],this.controlPoints[e][1],this.controlPoints[e][2]))<10&&(this.activeObj=e)}if(null==d){this.activeObj=null;for(var e=0;e<this.controlPoints.length;++e)this.distance(new THREE.Vector3(b,c,this.controlPoints[e][2]),new THREE.Vector3(this.controlPoints[e][0],this.controlPoints[e][1],this.controlPoints[e][2]))<10&&(this.activeObj=e)}},ASWObject.prototype.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return Math.sqrt(c*c+d*d+e*e)},ASWObject.prototype.eventOnMouseMove=function(a,b,c,d){null!=this.activeObj&&(4==this.activeObj&&null!=c?this.height=2*(c-this.controlPoints[1][1]):5==this.activeObj&&null!=b&&null!=d?this.depth=Math.sqrt(Math.pow(b-this.midpointOnCurve[0],2)+Math.pow(d-this.midpointOnCurve[2],2)):(null!=b&&(this.controlPoints[this.activeObj][0]=b),null!=c&&0!=this.height&&(this.controlPoints[this.activeObj][1]=c),null!=d&&(this.controlPoints[this.activeObj][2]=d))),this.updateControlPolygon(),this.updateGeometry()},ASWObject.prototype.render=function(){},ASWObject.prototype.getCenterPosition=function(){return[this.group.position.x,this.group.position.y,this.group.position.z]},ASWObject.prototype.storeValues=function(a,b,c){if(null===a&&(a=new Trial,a.type=this.objConfig.type,a.id=c,b.trials[b.trials.length]=a),0==this.height){var d=new SpatialASWRating;d.stimulus=this.objConfig.stimulus,d.name=this.objConfig.name,d.position_outerRight=this.controlPoints[3],d.position_innerRight=this.controlPoints[2],d.position_innerLeft=this.controlPoints[1],d.position_outerLeft=this.controlPoints[0],a.responses[a.responses.length]=d}else{var d=new SpatialHWDRating;d.stimulus=this.objConfig.stimulus,d.name=this.objConfig.name,d.position_outerRight=this.controlPoints[3],d.position_innerRight=this.controlPoints[2],d.position_innerLeft=this.controlPoints[1],d.position_outerLeft=this.controlPoints[0],d.height=this.height,d.depth=this.depth,a.responses[a.responses.length]=d}},LEVObject.prototype.init=function(a){a.add(this.dragNdrop0),a.add(this.dragNdrop1),a.add(this.dragNdrop2),a.add(this.dragNdrop3),a.add(this.xAxis),a.add(this.yAxis),a.add(this.zAxis),a.add(this.mesh)},LEVObject.prototype.eventOnMouseUp=function(a,b,c,d){this.activeObj=null},LEVObject.prototype.eventOnMouseDown=function(a,b,c,d){null==b?this.distance(new THREE.Vector3(this.dragNdrop0.position.x,c,d),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(this.dragNdrop1.position.x,c,d),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(this.dragNdrop2.position.x,c,d),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(this.dragNdrop3.position.x,c,d),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null:null==c&&(this.distance(new THREE.Vector3(b,this.dragNdrop0.position.y,d),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(b,this.dragNdrop1.position.y,d),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(b,this.dragNdrop2.position.y,d),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(b,this.dragNdrop3.position.y,d),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null),null==d&&(this.distance(new THREE.Vector3(b,c,this.dragNdrop0.position.z),new THREE.Vector3(this.dragNdrop0.position.x,this.dragNdrop0.position.y,this.dragNdrop0.position.z))<10?this.activeObj=0:this.distance(new THREE.Vector3(b,c,this.dragNdrop1.position.z),new THREE.Vector3(this.dragNdrop1.position.x,this.dragNdrop1.position.y,this.dragNdrop1.position.z))<10?this.activeObj=1:this.distance(new THREE.Vector3(b,c,this.dragNdrop2.position.z),new THREE.Vector3(this.dragNdrop2.position.x,this.dragNdrop2.position.y,this.dragNdrop2.position.z))<10?this.activeObj=2:this.distance(new THREE.Vector3(b,c,this.dragNdrop3.position.z),new THREE.Vector3(this.dragNdrop3.position.x,this.dragNdrop3.position.y,this.dragNdrop3.position.z))<10?this.activeObj=3:this.activeObj=null)},LEVObject.prototype.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return Math.sqrt(c*c+d*d+e*e)},LEVObject.prototype.eventOnMouseMove=function(a,b,c,d){null!=this.activeObj&&(0==this.activeObj?this.setPosition0(b,c,d):1==this.activeObj?this.setPosition1(b,c,d):2==this.activeObj?this.setPosition2(b,c,d):3==this.activeObj&&this.setPosition3(b,c,d))},LEVObject.prototype.render=function(){},LEVObject.prototype.getCenterPosition=function(){return[this.mesh.position.x,this.mesh.position.y,this.mesh.position.z]},LEVObject.prototype.setPosition0=function(a,b,c){null!=a&&(this.point1.x=this.point1.x-this.point0.x+a,this.point2.x=this.point2.x-this.point0.x+a,this.point0.x=a),null!=b&&(this.point1.y=this.point1.y-this.point0.y+b,this.point2.y=this.point2.y-this.point0.y+b,this.point0.y=b),null!=c&&(this.point1.z=this.point1.z-this.point0.z+c,this.point2.z=this.point2.z-this.point0.z+c,this.point0.z=c),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z,this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z;var d=this.dragNdrop3.position.y-this.dragNdrop0.position.y;this.dragNdrop0.position.x=this.point0.x,this.dragNdrop0.position.y=this.point0.y,this.dragNdrop0.position.z=this.point0.z,this.dragNdrop3.position.x=this.point0.x,this.dragNdrop3.position.y=this.point0.y+d,this.dragNdrop3.position.z=this.point0.z,this.dragNdrop1.position.y=this.point0.y,this.dragNdrop2.position.y=this.point0.y,this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition1=function(a,b,c){null!=a&&(this.point1.x=a),null!=b&&(this.point1.y=b),null!=c&&(this.point1.z=c),this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z;var d=Math.sqrt((this.point1.x-this.point0.x)*(this.point1.x-this.point0.x)+(this.point1.z-this.point0.z)*(this.point1.z-this.point0.z)),e=Math.sqrt((this.point2.x-this.point0.x)*(this.point2.x-this.point0.x)+(this.point2.z-this.point0.z)*(this.point2.z-this.point0.z)),f=this.point1.z-this.point0.z,g=-this.point1.x+this.point0.x,h=Math.sqrt(f*f+g*g),i=f/h,j=g/h,k=Math.sqrt(i*i+j*j);console.log(k),this.point2.x=i*e+this.point0.x,this.point2.z=j*e+this.point0.z,console.log(e),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z,this.mesh.scale.x=d,this.mesh.scale.z=e,this.mesh.rotation.y=Math.atan(-(this.point1.z-this.point0.z)/(this.point1.x-this.point0.x)),this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition2=function(a,b,c){null!=a&&(this.point2.x=a),null!=b&&(this.point2.y=b),null!=c&&(this.point2.z=c),this.dragNdrop2.position.x=this.point2.x,this.dragNdrop2.position.z=this.point2.z;var d=Math.sqrt((this.point1.x-this.point0.x)*(this.point1.x-this.point0.x)+(this.point1.z-this.point0.z)*(this.point1.z-this.point0.z)),e=Math.sqrt((this.point2.x-this.point0.x)*(this.point2.x-this.point0.x)+(this.point2.z-this.point0.z)*(this.point2.z-this.point0.z)),f=-this.point2.z+this.point0.z,g=this.point2.x-this.point0.x,h=Math.sqrt(f*f+g*g),i=f/h,j=g/h;this.point1.x=i*d+this.point0.x,this.point1.z=j*d+this.point0.z,this.dragNdrop1.position.x=this.point1.x,this.dragNdrop1.position.z=this.point1.z,this.mesh.scale.x=d,this.mesh.scale.z=e,this.mesh.rotation.y=Math.atan(-(this.point1.z-this.point0.z)/(this.point1.x-this.point0.x)),this.mesh.position.x=this.point0.x,this.mesh.position.y=this.point0.y,this.mesh.position.z=this.point0.z,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.setPosition3=function(a,b,c){this.point3.x=a,this.point3.y=b,this.point3.z=c,this.dragNdrop3.position.y=b;var d=this.point3.y-this.point0.y;this.mesh.scale.y=d,this.xAxis.geometry.verticesNeedUpdate=!0,this.yAxis.geometry.verticesNeedUpdate=!0,this.zAxis.geometry.verticesNeedUpdate=!0},LEVObject.prototype.storeValues=function(a,b,c){null===a&&(a=new Trial,a.type=this.objConfig.type,a.id=c,b.trials[b.trials.length]=a);var d=new SpatialLEVRating;d.name=this.objConfig.name,d.stimulus=this.objConfig.stimulus,d.position_center=[],d.position_width1=[],d.position_width2=[],d.position_height=[],d.position_center[0]=this.point0.x,d.position_center[1]=this.point0.y,d.position_center[2]=this.point0.z,d.position_width1[0]=this.point1.x,d.position_width1[1]=this.point1.y,d.position_width1[2]=this.point1.z,d.position_width2[0]=this.point2.x,d.position_width2[1]=this.point2.y,d.position_width2[2]=this.point2.z,d.position_height[0]=this.point3.x,d.position_height[1]=this.point3.y,d.position_height[2]=this.point3.z,a.responses[a.responses.length]=d},LocalizationObject.prototype.init=function(a){a.add(this.mesh)},LocalizationObject.prototype.eventOnMouseUp=function(a,b,c,d){},LocalizationObject.prototype.eventOnMouseDown=function(a,b,c,d){null!=b&&(this.mesh.position.x=b),null!=c&&(this.mesh.position.y=c),null!=d&&(this.mesh.position.z=d)},LocalizationObject.prototype.render=function(){},LocalizationObject.prototype.getCenterPosition=function(){return[this.mesh.position.x,this.mesh.position.y,this.mesh.position.z]},LocalizationObject.prototype.storeValues=function(a,b,c){null===a&&(a=new Trial,a.type=this.objConfig.type,a.id=c,b.trials[b.trials.length]=a);var d=new SpatialLocalizationRating;d.name=this.objConfig.name,d.stimulus=this.objConfig.stimulus,d.position=[],d.position[0]=this.mesh.position.x,d.position[1]=this.mesh.position.y,d.position[2]=this.mesh.position.z,a.responses[a.responses.length]=d},SpatialObject.prototype.getName=function(){return"template"},SpatialObject.prototype.init=function(){},SpatialObject.prototype.eventOnMouseUp=function(a){},SpatialObject.prototype.eventOnMouseDown=function(a){},SpatialObject.prototype.render=function(){},SpatialObject.prototype.storeValues=function(a,b,c){},Scene.prototype.transformRelativeCoordinates=function(a,b,c,d,e){var f=[null,null,null];if(1==this.wmCamera.type)"front"==this.viewConfig.view?(f[1]=-b+this.divHeight/2,f[0]=a):"back"==this.viewConfig.view?(f[1]=-b+this.divHeight/2,f[0]=-a):"top"==this.viewConfig.view?(f[0]=a,f[2]=b):"right"==this.viewConfig.view?(f[1]=-b+this.divHeight/2,f[2]=-a):"left"==this.viewConfig.view&&(f[1]=-b+this.divHeight/2,f[2]=a);else{var g=new THREE.Vector3(-this.wmCamera.getCameraX(),-this.wmCamera.getCameraY(),-this.wmCamera.getCameraZ()),h=new THREE.Vector3;h.copy(g),h.normalize();var i=new THREE.Quaternion;i.setFromUnitVectors(new THREE.Vector3(0,0,-1),new THREE.Vector3(h.x,0,h.z).normalize());var j=new THREE.Vector3;j=new THREE.Vector3(0,0,-1),j.applyQuaternion(i);var k=new THREE.Quaternion;k.setFromUnitVectors(j,h);var l=h.dot(new THREE.Vector3(c,d,e)),m=g.length()*Math.tan(22.5*Math.PI/180)/(this.divHeight/2),n=new THREE.Vector3(a*m,-b*m,0),o=n.applyQuaternion(i);o=o.applyQuaternion(k);var p=new THREE.Vector3(o.x,o.y,o.z),q=new THREE.Vector3;q.addVectors(g,p),q.normalize(),q.multiplyScalar(Math.sqrt(Math.pow(g.length()+l,2)+Math.pow(p.length()*(g.length()+l)/g.length(),2))),q.addVectors(q,g.negate()),f[0]=q.x,f[1]=q.y,f[2]=q.z}return f},Scene.prototype.load=function(){new DOMParser;this.setAmbientLight(15658734),this.setDirectionalLight(),this.scene.add(this.camera),this.buildRectangularElement()},Scene.prototype.render=function(){this.renderer.render(this.scene,this.camera)},Scene.prototype.buildRectangularElement=function(){this.width=this.pageConfig.roomMeasurements[0],this.height=this.pageConfig.roomMeasurements[1],this.depth=this.pageConfig.roomMeasurements[2];var a=THREE.ImageUtils.loadTexture("res/spatial/carpet.png");a.wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,a.repeat.x=8,a.repeat.y=8,this.materialFloor=new THREE.MeshBasicMaterial({map:a}),this.floor=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.depth),this.materialFloor);var b=new THREE.ImageUtils.loadTexture("res/spatial/ceiling.png");b.wrapS=THREE.RepeatWrapping,b.wrapT=THREE.RepeatWrapping,b.repeat.x=8,b.repeat.y=8;var c=new THREE.ImageUtils.loadTexture("res/spatial/wall.png");c.wrapS=THREE.RepeatWrapping,c.wrapT=THREE.RepeatWrapping,c.repeat.x=4,c.repeat.y=2,this.materialWall=new THREE.MeshLambertMaterial({map:c}),this.materialCeiling=new THREE.MeshLambertMaterial({map:b}),this.wall=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.height,10,10),this.materialWall),this.materialWallLeft=new THREE.MeshLambertMaterial({map:c}),this.wallfront=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.height,10,10),this.materialWall),this.materialWallLeft=new THREE.MeshLambertMaterial({map:c}),this.wallLeft=new THREE.Mesh(new THREE.PlaneGeometry(this.depth,this.height,10,10),this.materialWallLeft),this.materialWallRight=new THREE.MeshLambertMaterial({map:c}),this.wallRight=new THREE.Mesh(new THREE.PlaneGeometry(this.depth,this.height,10,10),this.materialWallRight),this.ceiling=new THREE.Mesh(new THREE.PlaneGeometry(this.width,this.depth,10,10),this.materialCeiling),this.material=new THREE.MeshBasicMaterial({map:b,wireframe:!0,opacity:.3}),this.floor.rotation.x=-Math.PI/2,this.wallLeft.position.x=-this.width/2,this.wallLeft.rotation.y=Math.PI/2,this.wallLeft.position.y=this.height/2,this.wallRight.position.x=this.width/2,this.wallRight.rotation.y=-Math.PI/2,this.wallRight.position.y=this.height/2,this.wall.position.z=-this.depth/2,this.wall.position.y=this.height/2,this.wallfront.position.z=this.depth/2,this.wallfront.position.y=this.height/2,this.wallfront.rotation.y=Math.PI,this.ceiling.position.y=this.height/2,this.ceiling.rotation.x=Math.PI/2,this.ceiling.position.y=this.height,this.scene.add(this.ceiling),this.scene.add(this.wallRight),this.scene.add(this.wallLeft),this.scene.add(this.wall),this.scene.add(this.wallfront),this.scene.add(this.floor)},Scene.prototype.getHeight=function(){return this.height},Scene.prototype.getWidth=function(){return this.width},Scene.prototype.getDepth=function(){return this.depth},Scene.prototype.addListener=function(_configListener){var x=_configListener.position[0],y0=0,y=_configListener.position[1],z=_configListener.position[2],rotx=2*(_configListener.rotation[0]+180)*Math.PI/360,roty=2*_configListener.rotation[1]*Math.PI/360,rotz=2*_configListener.rotation[2]*Math.PI/360,loader=new THREE.ColladaLoader,str="var tempScene = this.scene; loader.load('res/spatial/listener_head.dae', function(collada) {";str+="collada.scene.scale.x = collada.scene.scale.y = collada.scene.scale.z = 10;",str+="collada.scene.rotation.x =-Math.PI / 2 + "+rotx+";",
str+="collada.scene.rotation.y = "+roty+" - Math.PI;",str+="collada.scene.rotation.z = Math.PI + "+rotz+";",str+="collada.scene.position.x = "+x+";",str+="collada.scene.position.y = "+y+";",str+="collada.scene.position.z = "+z+";",str+="tempScene.add(collada.scene)",str+="});",eval(str)},Scene.prototype.addCustomObject=function(a){var b=new THREE.ColladaLoader,c=a.path,d={config:a,scene:this.scene};b.load(c,function(a){var b=this.config.position[0],c=this.config.position[1],d=this.config.position[2],e=2*this.config.rotation[0]*Math.PI/360,f=2*this.config.rotation[1]*Math.PI/360,g=2*this.config.rotation[2]*Math.PI/360;a.scene.scale.x=a.scene.scale.y=a.scene.scale.z=this.config.scale,a.scene.position.x=b,a.scene.position.y=c,a.scene.position.z=d,a.scene.rotation.x=-Math.PI/2+e,a.scene.rotation.y=f,a.scene.rotation.z=g,this.scene.add(a.scene)}.bind(d))},Scene.prototype.setDirectionalLight=function(){var a=new THREE.DirectionalLight(10066329);a.position.set(0,100,0),a.target.position.set(0,0,0),a.castShadow=!0,a.shadowDarkness=.2,a.shadowCameraVisible=!0,this.scene.add(a);var b=new THREE.DirectionalLight(6710886);b.position.set(100,0,0),b.target.position.set(0,0,0),b.castShadow=!0,b.shadowDarkness=.2,b.shadowCameraVisible=!0,this.scene.add(b);var c=new THREE.DirectionalLight(6710886);c.position.set(-100,0,0),c.target.position.set(0,0,0),c.castShadow=!0,c.shadowDarkness=.2,c.shadowCameraVisible=!0,this.scene.add(c);var d=new THREE.DirectionalLight(6710886);d.position.set(0,0,100),d.target.position.set(0,0,0),d.castShadow=!0,d.shadowDarkness=.2,d.shadowCameraVisible=!0,this.scene.add(d);var e=new THREE.DirectionalLight(6710886);e.position.set(0,0,-100),e.target.position.set(0,0,0),e.castShadow=!0,e.shadowDarkness=.2,e.shadowCameraVisible=!0,this.scene.add(e)},Scene.prototype.setAmbientLight=function(a){this.ambient=new THREE.AmbientLight(a),this.scene.add(this.ambient)},Scene.prototype.setGridWall=function(a){1==a?this.wall.material=this.material:0==a&&(this.wall.material=this.materialWall)},Scene.prototype.setGridWallLeft=function(a){1==a?this.wallLeft.material=this.material:0==a&&(this.wallLeft.material=this.materialWallLeft)},Scene.prototype.setGridWallRight=function(a){1==a?this.wallRight.material=this.material:0==a&&(this.wallRight.material=this.materialWallRight)},Scene.prototype.setGridFloor=function(a){1==a?this.floor.material=this.material:0==a&&(this.floor.material=this.materialFloor)},Scene.prototype.setGridCeiling=function(a){1==a?this.ceiling.material=this.material:0==a&&(this.ceiling.material=this.materialCeiling)},Scene.prototype.setColorLeftWall=function(a){this.wallLeft.material.color.setHex(a)},Scene.prototype.getColorWall=function(){return this.wall.material.color.getHex()},Scene.prototype.setColorWall=function(a){this.wall.material.color.setHex(a)};